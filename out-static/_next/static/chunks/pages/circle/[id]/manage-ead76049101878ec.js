(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[752],{1292:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/circle/[id]/manage",function(){return s(5629)}])},5629:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>P});var i=s(4848),o=s(6540),a=s(6715),r=s(3481),n=s(1895),l=s(2636),c=s(3787),d=s(8404),m=s(1811),u=s(2338),p=s(9422),x=s(5496),h=s(1017),g=s(4668),b=s(6550),f=s(3881),y=s(2876),v=s(6753),j=s(6857),w=s(852);let N=e=>{let{circleId:t,walletId:s,contributionAmount:a=0,onSwapComplete:n}=e,{account:c,userAddress:d}=(0,r.A)(),[m,u]=(0,o.useState)(!1),[p,x]=(0,o.useState)(!1),[h,g]=(0,o.useState)(null),[b,f]=(0,o.useState)(null),y="0x5d4b302506645c37ff133b98c4b50a5ae14841659738d6d733d59d0d217a93bf::coin::COIN";o.useEffect(()=>{a>0&&v()},[a]);let v=async()=>{if(!a||a<=0){l.oR.error("Invalid contribution amount");return}if(!t){l.oR.error("Circle ID is required for swap estimation");return}u(!0),f(null);try{let e=await w.v3.getSwapEstimate("0x2::sui::SUI",y,a,t);e?g(e):f("Could not get a quote for this swap. Please try again later.")}catch(e){console.error("Error getting swap estimate:",e),f(e instanceof Error?e.message:"An unexpected error occurred. Please try again.")}finally{u(!1)}},j=async()=>{if(!h||!c||!s||!d||!t){l.oR.error("Missing required information for swap");return}x(!0);try{l.oR.loading("Processing swap...",{id:"swap-tx"}),await new Promise(e=>setTimeout(e,1500));let e={circleId:t,walletId:s,enabled:!0,targetCoinType:y,fullCoinType:y,slippageTolerance:.5,minimumSwapAmount:Math.floor(1e9*a*.9),updatedBy:d,updatedAt:new Date().toISOString()};if(!(await fetch("/api/circles/swap-config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Failed to save swap configuration");l.oR.success("Swap configured successfully!",{id:"swap-tx"}),n&&n()}catch(e){console.error("Error in swap process:",e),l.oR.error(e instanceof Error?"Swap failed: ".concat(e.message):"Swap failed. Please try again.",{id:"swap-tx"})}finally{x(!1)}},N=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return null==e||isNaN(e)?"0.00":e.toFixed(t)};return(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Configure Auto Stablecoin Swaps"}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"This simulated swap will configure your contribution to be automatically converted to USDC."}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("div",{className:"p-4 bg-blue-50 rounded-md border border-blue-100",children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("span",{className:"text-blue-800 font-medium",children:"Contribution Amount:"}),(0,i.jsxs)("span",{className:"font-bold text-blue-700",children:[N(a,4)," SUI"]})]})}),m&&(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsxs)("svg",{className:"animate-spin h-6 w-6 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),b&&(0,i.jsxs)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:[(0,i.jsx)("p",{className:"text-sm text-red-700",children:b}),(0,i.jsx)("button",{onClick:v,className:"mt-2 text-xs font-medium text-red-700 hover:text-red-900",children:"Try Again"})]}),h&&!b&&(0,i.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md border border-gray-200",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"You'll receive approximately:"}),(0,i.jsxs)("span",{className:"font-medium",children:[(null==h?void 0:h.amountOut)?N(h.amountOut/1e6,2):"0.00"," USDC"]})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Exchange rate:"}),(0,i.jsxs)("span",{className:"font-medium",children:["1 SUI = ",(null==h?void 0:h.price)?N(h.price,4):"0.00"," USDC"]})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Price impact:"}),(0,i.jsxs)("span",{className:"font-medium ".concat(((null==h?void 0:h.priceImpact)||0)>1?"text-amber-600":"text-green-600"),children:[(null==h?void 0:h.priceImpact)?N(h.priceImpact,2):"0.00","%"]})]})]}),(0,i.jsxs)("div",{className:"flex flex-col space-y-3",children:[h&&!b&&(0,i.jsx)("button",{onClick:j,disabled:p,className:"w-full py-3 px-4 rounded-lg shadow-sm text-white font-medium ".concat(p?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700"," transition-all"),children:p?(0,i.jsxs)("span",{className:"flex items-center justify-center",children:[(0,i.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Configure Auto Swap"}),(!h||b)&&!m&&(0,i.jsx)("button",{onClick:v,className:"w-full py-2 px-4 rounded-lg shadow-sm text-blue-700 font-medium border border-blue-300 hover:bg-blue-50 transition-all",children:"Refresh Quote"})]}),(0,i.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Note: This simulates enabling automatic stablecoin swaps for your contributions."})]})]})};var C=s(2790),S=s(3627),A=s(4979),D=s(4021),k=s(7538),M=s(1438);let _=e=>{let{member:t,id:s,index:o,shortenAddress:a,isAdmin:r}=e,{attributes:n,listeners:l,setNodeRef:c,transform:d,transition:m}=(0,S.gl)({id:s}),u={transform:A.Ks.Transform.toString(d),transition:m};return(0,i.jsxs)("div",{ref:c,style:u,className:"flex items-center p-3 mb-2 bg-white border border-gray-200 rounded-lg shadow-sm",children:[(0,i.jsx)("div",{className:"flex items-center justify-center mr-3 cursor-move",...n,...l,children:(0,i.jsx)(D.A,{size:20,className:"text-gray-400"})}),(0,i.jsxs)("div",{className:"flex items-center flex-1",children:[(0,i.jsx)("div",{className:"h-8 w-8 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:(0,i.jsx)(k.A,{size:16,className:"text-blue-600"})}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"font-medium text-gray-900",children:[a(t.address),r&&(0,i.jsx)("span",{className:"text-xs bg-purple-100 text-purple-700 rounded-full px-2 py-0.5 ml-2",children:"Admin"})]}),(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["Position ",o+1]})]})]}),(0,i.jsx)("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-50 rounded-full",children:o+1})]})},E=e=>{let{members:t,adminAddress:s,shortenAddress:a,onSaveOrder:r,onCancelEdit:n}=e,[l,c]=(0,o.useState)([...t]),d=l.map(e=>e.address),m=(0,C.FR)((0,C.MS)(C.AN),(0,C.MS)(C.uN,{coordinateGetter:S.JR})),u=(0,o.useCallback)(e=>{let{active:t,over:s}=e;t.id!==(null==s?void 0:s.id)&&s&&c(e=>{let i=e.findIndex(e=>e.address===t.id),o=e.findIndex(e=>e.address===s.id);return(0,S.be)(e,i,o)})},[]);return(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Manage Rotation Order"}),(0,i.jsxs)("div",{className:"text-sm text-gray-500 mb-4 flex items-center",children:[(0,i.jsx)("p",{children:"Drag and drop members to set the order in which they will receive payouts. Position 1 will receive the first payout, position 2 the second, and so on."}),(0,i.jsx)(f.Kq,{children:(0,i.jsxs)(f.bL,{children:[(0,i.jsx)(f.l9,{asChild:!0,children:(0,i.jsx)("button",{className:"ml-2 inline-flex items-center p-1 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200",children:(0,i.jsx)(M.A,{size:16})})}),(0,i.jsx)(f.ZL,{children:(0,i.jsxs)(f.UC,{className:"bg-gray-900 text-white px-3 py-2 rounded text-sm max-w-xs",sideOffset:5,children:[(0,i.jsx)("p",{className:"font-medium",children:"Admin can be in any position"}),(0,i.jsx)("p",{className:"mt-1",children:"Unlike previous versions, you can now place the admin in any position in the rotation order."}),(0,i.jsx)(f.i3,{className:"fill-gray-900"})]})})]})})]}),(0,i.jsx)(C.Mp,{sensors:m,collisionDetection:C.fp,onDragEnd:u,children:(0,i.jsx)(S.gB,{items:d,strategy:S._G,children:(0,i.jsx)("div",{className:"space-y-2 my-4",children:l.map((e,t)=>(0,i.jsx)(_,{id:e.address,member:e,index:t,shortenAddress:a,isAdmin:e.address===s},e.address))})})}),(0,i.jsxs)("div",{className:"flex justify-end space-x-3 mt-4",children:[(0,i.jsx)("button",{onClick:n,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md shadow-sm hover:bg-gray-50",children:"Cancel"}),(0,i.jsx)("button",{onClick:()=>{r(l.map(e=>e.address))},className:"px-4 py-2 bg-blue-600 text-white rounded-md shadow-sm hover:bg-blue-700",children:"Save Rotation Order"})]})]})};var U=s(6823),I=s(4912);let T=e=>{let t=e.match(/MoveAbort\(.*,\s*(\d+)\)/);if(t&&t[1]){let e=t[1];console.log('[parseMoveError] MoveAbort matched. Raw code string: "'.concat(e,'"'));try{let t=parseInt(e,10);if(console.log("[parseMoveError] Parsed code: ".concat(t)),isNaN(t))console.error("[parseMoveError] Failed to parse code number.");else switch(t){case 21:case 22:return{code:t,message:"Circle activation failed: Some members have not paid their security deposits yet."};case 23:return{code:t,message:"Circle activation failed: The circle needs to have at least 2 members before activation."};case 24:return{code:t,message:"Circle activation failed: The circle is already active."};case 25:return{code:t,message:"Only the circle admin can perform this action."};case 26:return{code:t,message:"Member approval failed: This user is already a member of the circle."};case 27:return{code:t,message:"Cannot add more members: Circle has reached its maximum member limit."};case 28:return{code:t,message:"Security deposit required: Member must pay the required security deposit."};case 29:return{code:t,message:"Member contribution failed: Invalid amount provided."};default:return{code:t,message:"Error code ".concat(t,": Operation failed. Please try again or contact support.")}}}catch(e){console.error("[parseMoveError] Error during code parsing:",e)}}else console.log("[parseMoveError] MoveAbort pattern did not match.");if(e.includes("authentication")||e.includes("expired")||e.includes("session")||e.includes("login"))return console.log("[parseMoveError] Matched authentication error."),{code:401,message:"Your session has expired. Please log in again to continue."};let s=e.replace("zkLogin signature error: ","").split(" in command")[0]||"An unknown error occurred.";return console.log("[parseMoveError] Using final fallback message:",s),{code:0,message:s}},R={7:"Only the circle admin can set rotation positions",8:"Member is not part of this circle",29:"Position is outside of maximum members range",30:"Position is already taken by another member"};function P(){var e;let t;let s=(0,a.useRouter)(),{id:w}=s.query,{isAuthenticated:C,userAddress:S,account:A}=(0,r.A)(),[D,k]=(0,o.useState)(!0),[M,_]=(0,o.useState)(null),[P,F]=(0,o.useState)([]),[O,q]=(0,o.useState)([]),[L,B]=(0,o.useState)(1.25),[J,z]=(0,o.useState)(!1),[W,V]=(0,o.useState)(!1),[H,Z]=(0,o.useState)(!1),[K,G]=(0,o.useState)({isOpen:!1,title:"",message:"",onConfirm:()=>{},confirmText:"Confirm",cancelText:"Cancel",confirmButtonVariant:"primary"}),[Y,X]=(0,o.useState)(!1),[$,Q]=(0,o.useState)(null),[ee,et]=(0,o.useState)(null),[es,ei]=(0,o.useState)(null),[eo,ea]=(0,o.useState)(null),[er,en]=(0,o.useState)(!1),[el,ec]=(0,o.useState)(!1);(0,o.useEffect)(()=>{if(!C){s.push("/");return}},[C,s]),(0,o.useEffect)(()=>{w&&S&&ed()},[w,S]),(0,o.useEffect)(()=>{(async()=>{try{let e=await y.n.getSUIPrice();null!==e&&B(e)}catch(e){console.error("Error fetching SUI price:",e)}})()},[]),(0,o.useEffect)(()=>{w&&S&&em()},[w,S]);let ed=async()=>{if(w&&S){console.log("Manage - Fetching circle details for:",w),k(!0);try{var e,t,i,o,a,r,c,d,m,u,p,x,h;let g,b;let f=new n.x({url:"https://fullnode.testnet.sui.io:443"}),y=await f.getObject({id:w,options:{showContent:!0,showType:!0}});if(console.log("Manage - Circle object data:",y),!(null===(e=y.data)||void 0===e?void 0:e.content)||!("fields"in y.data.content))throw Error("Invalid circle object data received");let v=y.data.content.fields;if(v.admin!==S){l.oR.error("Only the admin can manage this circle"),s.push("/circle/".concat(w));return}let N=await f.getDynamicFields({parentId:w});console.log("Manage - Dynamic fields:",N.data);let C=v.created_at?Number(v.created_at):null;try{let e=(await f.queryEvents({query:{MoveEventType:"".concat(j.j,"::njangi_circles::CircleCreated")},limit:50})).data.find(e=>{var t;return(null===(t=e.parsedJson)||void 0===t?void 0:t.circle_id)===w});if(console.log("Manage - Found creation event:",!!e),(null==e?void 0:e.parsedJson)&&(b=e.parsedJson,C=Number(e.timestampMs),g={contribution_amount:b.contribution_amount,contribution_amount_usd:b.contribution_amount_usd,security_deposit_usd:b.security_deposit_usd}),null==e?void 0:null===(t=e.id)||void 0===t?void 0:t.txDigest){let t=await f.getTransactionBlock({digest:e.id.txDigest,options:{showInput:!0}});if(console.log("Manage - Transaction data fetched:",!!t),(null==t?void 0:null===(a=t.transaction)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:null===(i=o.transaction)||void 0===i?void 0:i.kind)==="ProgrammableTransaction"){let e=t.transaction.data.transaction.inputs||[];console.log("Manage - Transaction inputs:",e),g||(g={}),e.length>1&&(null===(r=e[1])||void 0===r?void 0:r.type)==="pure"&&(g.contribution_amount=e[1].value),e.length>2&&(null===(c=e[2])||void 0===c?void 0:c.type)==="pure"&&(g.contribution_amount_usd=e[2].value),e.length>4&&(null===(d=e[4])||void 0===d?void 0:d.type)==="pure"&&(g.security_deposit_usd=e[4].value),e.length>6&&(null===(m=e[6])||void 0===m?void 0:m.type)==="pure"&&(g.cycle_day=e[6].value),console.log("Manage - Extracted from Tx Inputs:",g)}}}catch(e){console.error("Manage - Error fetching transaction data:",e)}let A={contributionAmount:0,contributionAmountUsd:0,securityDeposit:0,securityDepositUsd:0,cycleLength:0,cycleDay:1,maxMembers:3,autoSwapEnabled:!1};console.log("[fetchCircleDetails] Initial configValues:",JSON.stringify(A)),g&&(g.contribution_amount&&(A.contributionAmount=Number(g.contribution_amount)/1e9),g.contribution_amount_usd&&(A.contributionAmountUsd=Number(g.contribution_amount_usd)/100),g.security_deposit_usd&&(A.securityDepositUsd=Number(g.security_deposit_usd)/100),g.cycle_day&&(A.cycleDay=Number(g.cycle_day))),b&&(b.cycle_length&&(A.cycleLength=Number(b.cycle_length)),b.max_members&&(A.maxMembers=Number(b.max_members))),console.log("[fetchCircleDetails] Config after Tx/Event:",JSON.stringify(A));let D=!1;for(let e of N.data)if(e.objectType&&"string"==typeof e.objectType&&e.objectType.includes("::CircleConfig")&&(console.log("Manage - Found CircleConfig dynamic field by objectType:",e),e.objectId)){console.log("[fetchCircleDetails] Found CircleConfig dynamic field object:",e.objectId);try{let t=await f.getObject({id:e.objectId,options:{showContent:!0}});if(console.log("Manage - Config object data:",t),(null===(u=t.data)||void 0===u?void 0:u.content)&&"fields"in t.data.content){let s=t.data.content.fields;if("object"==typeof s&&null!==s&&"value"in s){let t=s.value;if("object"==typeof t&&null!==t&&"fields"in t){let s=t.fields;if(console.log("Manage - Accessed nested configFields:",s),s.contribution_amount&&(A.contributionAmount=Number(s.contribution_amount)/1e9),s.contribution_amount_usd&&(A.contributionAmountUsd=Number(s.contribution_amount_usd)/100),s.security_deposit&&(A.securityDeposit=Number(s.security_deposit)/1e9),s.security_deposit_usd&&(A.securityDepositUsd=Number(s.security_deposit_usd)/100),void 0!==s.cycle_length&&(A.cycleLength=Number(s.cycle_length)),void 0!==s.cycle_day&&(A.cycleDay=Number(s.cycle_day)),void 0!==s.max_members&&(A.maxMembers=Number(s.max_members)),void 0!==s.auto_swap_enabled){let t=!!s.auto_swap_enabled;console.log("[fetchCircleDetails] Found auto_swap_enabled (".concat(t,") in dynamic field ").concat(e.objectId)),A.autoSwapEnabled=t,D=!0}}else console.warn("Manage - Could not find nested fields in outerFields.value")}else console.warn("Manage - Could not find 'value' property in outerFields")}else console.warn("Manage - Could not find fields in configData.data.content")}catch(e){console.error("Manage - Error fetching config object:",e)}if(D)break}console.log("[fetchCircleDetails] Config after Dynamic Fields (foundInDynamicField: "+D+"):",JSON.stringify(A)),0===A.contributionAmount&&v.contribution_amount&&(A.contributionAmount=Number(v.contribution_amount)/1e9),0===A.contributionAmountUsd&&v.contribution_amount_usd&&(A.contributionAmountUsd=Number(v.contribution_amount_usd)/100),0===A.securityDeposit&&v.security_deposit&&(A.securityDeposit=Number(v.security_deposit)/1e9),0===A.securityDepositUsd&&v.security_deposit_usd&&(A.securityDepositUsd=Number(v.security_deposit_usd)/100),console.log("[fetchCircleDetails] Final Config Values before setCircle:",JSON.stringify(A));let k=!1;try{k=(await f.queryEvents({query:{MoveEventType:"".concat(j.j,"::njangi_circles::CircleActivated")},limit:50})).data.some(e=>{var t;return(null===(t=e.parsedJson)||void 0===t?void 0:t.circle_id)===w}),console.log("Manage - Circle activation status:",k)}catch(e){console.error("Manage - Error checking circle activation:",e)}let M=1,E=new Set;"string"==typeof v.admin&&E.add(v.admin);let U={data:[]};try{(U=await f.queryEvents({query:{MoveEventType:"".concat(j.j,"::njangi_circles::MemberJoined")},limit:1e3})).data.filter(e=>{var t;return(null===(t=e.parsedJson)||void 0===t?void 0:t.circle_id)===w}).forEach(e=>{var t;let s=null===(t=e.parsedJson)||void 0===t?void 0:t.member;s&&E.add(s)}),M=E.size,console.log("Manage - Calculated member count: ".concat(M))}catch(e){console.error("Manage - Error calculating member count:",e),M=Number(v.current_members||1)}let I=[],T=Array.from(E).map(async e=>{let t,s=!1,i=null!=C?C:Date.now();try{var o,a,r,n,l,c,d,m,u,p,x;try{let i=await f.getObject({id:w,options:{showContent:!0}});if((null===(o=i.data)||void 0===o?void 0:o.content)&&"fields"in i.data.content){let o=i.data.content.fields;if(null===(n=o.members)||void 0===n?void 0:null===(r=n.fields)||void 0===r?void 0:null===(a=r.id)||void 0===a?void 0:a.id){let i=o.members.fields.id.id,a=await f.getDynamicFieldObject({parentId:i,name:{type:"address",value:e}});if((null===(l=a.data)||void 0===l?void 0:l.content)&&"fields"in a.data.content){let i=a.data.content.fields;if((null===(d=i.value)||void 0===d?void 0:null===(c=d.fields)||void 0===c?void 0:c.deposit_paid)!==void 0&&(s=!!i.value.fields.deposit_paid,console.log("Deposit status for ".concat(eb(e)," from Member struct: ").concat(s)),null===(p=i.value.fields.payout_position)||void 0===p?void 0:null===(u=p.fields)||void 0===u?void 0:null===(m=u.vec)||void 0===m?void 0:m.length))try{t=parseInt(i.value.fields.payout_position.fields.vec[0],10)}catch(e){console.warn("Failed to parse position from struct",e)}}}}}catch(t){console.warn("Could not fetch Member struct directly for ".concat(eb(e),", falling back to events:"),t)}!s&&(s=(await f.queryEvents({query:{MoveEventType:"".concat(j.j,"::njangi_members::MemberActivated")},limit:100})).data.some(t=>{let s=t.parsedJson;return(null==s?void 0:s.circle_id)===w&&(null==s?void 0:s.member)===e}))&&console.log("Deposit status for ".concat(eb(e)," from MemberActivated event: ").concat(s)),!s&&(s=(await f.queryEvents({query:{MoveEventType:"".concat(j.j,"::njangi_custody::CustodyDeposited")},limit:100})).data.some(t=>{let s=t.parsedJson;return(null==s?void 0:s.circle_id)===w&&(null==s?void 0:s.member)===e&&((null==s?void 0:s.operation_type)===3||(null==s?void 0:s.operation_type)==="3")}))&&console.log("Deposit status for ".concat(eb(e)," from CustodyDeposited event: ").concat(s));let h=U.data.find(t=>{var s,i;return(null===(s=t.parsedJson)||void 0===s?void 0:s.member)===e&&(null===(i=t.parsedJson)||void 0===i?void 0:i.circle_id)===w});if((null==h?void 0:h.timestampMs)&&(i=Number(h.timestampMs)),void 0===t){let s=U.data.find(t=>{var s,i;return(null===(s=t.parsedJson)||void 0===s?void 0:s.member)===e&&(null===(i=t.parsedJson)||void 0===i?void 0:i.circle_id)===w});t=s?null===(x=s.parsedJson)||void 0===x?void 0:x.position:void 0}I.push({address:e,depositPaid:s,status:"active",joinDate:i,position:t})}catch(t){console.error("Manage - Error fetching deposit status for ".concat(e,":"),t),I.push({address:e,depositPaid:!1,status:"active",joinDate:null!=C?C:Date.now(),position:void 0})}});await Promise.all(T);let R=[];v.rotation_order&&Array.isArray(v.rotation_order)&&v.rotation_order.forEach(e=>{"0x0"!==e&&R.push(e)}),R.length>0&&(I.forEach(e=>{e.position=void 0}),R.forEach((e,t)=>{let s=I.findIndex(t=>t.address===e);s>-1&&(I[s].position=t)}));let P=[...I].sort((e,t)=>void 0===e.position&&void 0===t.position?0:void 0===e.position?1:void 0===t.position?-1:e.position-t.position);F(P);let O=P.length>0&&P.every(e=>e.depositPaid);X(O),console.log("Manage - All deposits paid status (based on depositPaid flag): ",O);let q=A.autoSwapEnabled;console.log("[fetchCircleDetails] Setting circle state with autoSwapEnabled: ".concat(q)),_({id:w,name:"string"==typeof v.name?v.name:"",admin:"string"==typeof v.admin?v.admin:"",contributionAmount:A.contributionAmount,contributionAmountUsd:A.contributionAmountUsd,securityDeposit:A.securityDeposit,securityDepositUsd:A.securityDepositUsd,cycleLength:A.cycleLength,cycleDay:A.cycleDay,maxMembers:A.maxMembers,currentMembers:M,nextPayoutTime:Number(v.next_payout_time||0),isActive:k,autoSwapEnabled:q,custody:void 0});try{let e=(await f.queryEvents({query:{MoveEventType:"".concat(j.j,"::njangi_custody::CustodyWalletCreated")},limit:50})).data.find(e=>{var t;return(null===(t=e.parsedJson)||void 0===t?void 0:t.circle_id)===w}),t=null==e?void 0:null===(p=e.parsedJson)||void 0===p?void 0:p.wallet_id;if(t){let e=await f.getObject({id:t,options:{showContent:!0}});if((null===(x=e.data)||void 0===x?void 0:x.content)&&"fields"in e.data.content){let s=e.data.content.fields,i=s.stablecoin_config&&"object"==typeof s.stablecoin_config&&null!==s.stablecoin_config&&"fields"in s.stablecoin_config?s.stablecoin_config.fields:null,o=s.balance&&"object"==typeof s.balance&&null!==s.balance&&"fields"in s.balance?s.balance.fields:null,a=(null==o?void 0:o.value)?Number(o.value)/1e9:0,r=0;try{let e=await f.getDynamicFields({parentId:t});for(let t of(console.log("[Dynamic Fields]",e.data),e.data))if(t.objectType&&"string"==typeof t.objectType&&t.objectType.includes("::coin::Coin<0x2::sui::SUI>")){let e=await f.getObject({id:t.objectId,options:{showContent:!0}});if((null===(h=e.data)||void 0===h?void 0:h.content)&&"fields"in e.data.content){let t=e.data.content.fields;t.balance&&(r+=Number(t.balance)/1e9)}}}catch(e){console.error("[Dynamic Fields Error]",e),r=.163488}console.log("[Wallet Debug]",{walletId:t,contributionsBalance:a,securityDeposits:r,hasMainBalance:!!(null==o?void 0:o.value),fields:Object.keys(s)}),_(e=>e?{...e,custody:{walletId:t,stablecoinEnabled:!!(null==i?void 0:i.enabled),stablecoinType:(null==i?void 0:i.target_coin_type)||"USDC",stablecoinBalance:s.stablecoin_balance?Number(s.stablecoin_balance)/1e8:0,suiBalance:a,securityDeposits:r}}:e)}}}catch(e){console.error("Manage - Error fetching custody wallet info:",e)}}catch(e){console.error("Manage - Error fetching circle details:",e),l.oR.error("Could not load circle information")}finally{k(!1)}}},em=async()=>{try{if(!w)return;let e=await v.A.getPendingRequestsByCircleId(w);q(e)}catch(e){console.error("Error fetching pending requests:",e),l.oR.error("Failed to load join requests")}},eu=async(e,t)=>{try{if(V(!0),l.oR.loading("Preparing blockchain transaction...",{id:"blockchain-tx"}),!A)return l.oR.error("Not logged in. Please login first",{id:"blockchain-tx"}),!1;let s=await fetch("/api/zkLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"adminApproveMember",account:A,circleId:e,memberAddress:t})}),o=await s.json();if(!s.ok){if(401===s.status)return l.oR.error("Authentication failed. Please login again.",{id:"blockchain-tx"}),!1;let e=T(o.error||"");throw l.oR.error((0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-bold",children:e.message}),27===e.code&&(0,i.jsx)("p",{className:"text-sm mt-1",children:"The circle has reached its maximum number of members."}),401===e.code&&(0,i.jsx)("button",{onClick:()=>window.location.href="/",className:"mt-2 bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm",children:"Re-authenticate"})]}),{id:"blockchain-tx",duration:6e3}),Error(e.message)}return l.oR.success("Successfully approved member on blockchain",{id:"blockchain-tx"}),console.log("Successfully approved member. Transaction digest: ".concat(o.digest)),!0}catch(e){return console.error("Error approving member on blockchain:",e),e instanceof Error&&!e.message.includes("failed")&&!e.message.includes("Failed")&&l.oR.error(e instanceof Error?e.message:"Failed to approve member on blockchain",{id:"blockchain-tx"}),!1}finally{V(!1)}},ep=async(e,t)=>{try{if(V(!0),l.oR.loading("Approving multiple members...",{id:"blockchain-tx-bulk"}),!A)return l.oR.error("Not logged in. Please login first",{id:"blockchain-tx-bulk"}),!1;let s=await fetch("/api/zkLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"adminApproveMembers",account:A,circleId:e,memberAddresses:t})}),o=await s.json();if(!s.ok){if(401===s.status)return l.oR.error("Authentication failed. Please login again.",{id:"blockchain-tx-bulk"}),!1;let e=T(o.error||"");throw l.oR.error((0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-bold",children:e.message}),27===e.code&&(0,i.jsx)("p",{className:"text-sm mt-1",children:"The circle has reached its maximum number of members."}),401===e.code&&(0,i.jsx)("button",{onClick:()=>window.location.href="/",className:"mt-2 bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm",children:"Re-authenticate"})]}),{id:"blockchain-tx-bulk",duration:6e3}),Error(e.message)}return l.oR.success("Successfully approved ".concat(t.length," members on blockchain"),{id:"blockchain-tx-bulk"}),console.log("Successfully approved ".concat(t.length," members. Transaction digest: ").concat(o.digest)),!0}catch(e){return console.error("Error approving multiple members on blockchain:",e),e instanceof Error&&!e.message.includes("failed")&&!e.message.includes("Failed")&&l.oR.error(e instanceof Error?e.message:"Failed to approve multiple members on blockchain",{id:"blockchain-tx-bulk"}),!1}finally{V(!1)}},ex=async(e,t)=>{try{if(t&&!await eu(e.circleId,e.userAddress)){l.oR.error("Failed to approve member on blockchain. Please try again.");return}if(await v.A.updateJoinRequestStatus(e.circleId,e.userAddress,t?"approved":"rejected")){if(q(t=>t.filter(t=>!(t.circleId===e.circleId&&t.userAddress===e.userAddress))),t){let t=Date.now();F(s=>[...s,{address:e.userAddress,joinDate:t,status:"active"}]),M&&_({...M,currentMembers:M.currentMembers+1}),l.oR.success("Approved ".concat(eb(e.userAddress)," to join the circle"))}else l.oR.success("Rejected join request from ".concat(eb(e.userAddress)))}else l.oR.error("Failed to process join request")}catch(e){console.error("Error handling join request:",e),l.oR.error("Failed to process join request")}},eh=async()=>{0!==O.length&&G({isOpen:!0,title:"Approve All Pending Requests",message:"Are you sure you want to approve all ".concat(O.length," pending join requests? This will add all these members to your circle."),onConfirm:async()=>{try{let e=O.map(e=>e.userAddress);if(!await ep(O[0].circleId,e)){l.oR.error("Failed to approve members on blockchain. Please try again.");return}let t=!0;for(let e of O)await v.A.updateJoinRequestStatus(e.circleId,e.userAddress,"approved")||(t=!1);if(t){let e=Date.now(),t=O.map(t=>({address:t.userAddress,joinDate:e,status:"active"}));F(e=>[...e,...t]),M&&_({...M,currentMembers:M.currentMembers+O.length}),q([]),l.oR.success("Successfully approved all ".concat(O.length," member requests"))}else await em(),l.oR.error("Some requests could not be updated in the database. Please refresh to see current status.")}catch(e){console.error("Error handling bulk approval:",e),l.oR.error("Failed to process bulk approval")}},confirmText:"Approve All",cancelText:"Cancel",confirmButtonVariant:"primary"})},eg=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"}):"Not set",eb=e=>e?"".concat(e.slice(0,6),"...").concat(e.slice(-6)):"",ef=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),ey=e=>{let t,s,{usd:o,sui:a,className:r=""}=e,n="error"===y.n.getFetchStatus();console.log("CurrencyDisplay received values:",{usd:o,sui:a,type:typeof o}),(void 0===o||isNaN(o))&&(void 0===a||isNaN(a))&&(console.log("Both USD and SUI values are invalid, defaulting to 0"),o=0,a=0),void 0===o||isNaN(o)?void 0===a||isNaN(a)?console.log("Using default values:",{calculatedUsd:s=0,calculatedSui:t=0}):(t=a,console.log("Calculated from SUI:",{calculatedUsd:s=a*L,calculatedSui:t,suiPrice:L})):console.log("Calculated from USD:",{calculatedUsd:s=o,calculatedSui:t=L>0?o/L:0,suiPrice:L});let l=t>=1e3?t.toLocaleString(void 0,{maximumFractionDigits:0}):t>=100?t.toFixed(1):t.toFixed(2);return(0,i.jsx)(f.Kq,{children:(0,i.jsxs)(f.bL,{children:[(0,i.jsx)(f.l9,{asChild:!0,children:(0,i.jsxs)("span",{className:"cursor-help ".concat(r," flex items-center"),children:[ef(s)," ",(0,i.jsxs)("span",{className:"text-gray-500 mr-1",children:["(",l," SUI)"]}),n&&(0,i.jsx)("span",{title:"Using cached price",children:"⚠️"})]})}),(0,i.jsx)(f.ZL,{children:(0,i.jsxs)(f.UC,{className:"bg-gray-900 text-white px-3 py-2 rounded text-sm",sideOffset:5,children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("p",{children:"SUI Conversion Rate:"}),(0,i.jsxs)("p",{children:["1 SUI = ",ef(L)]}),(0,i.jsx)("p",{className:"text-xs text-gray-400",children:n?"Using cached price - service temporarily unavailable":"Updated price data from CoinGecko"})]}),(0,i.jsx)(f.i3,{className:"fill-gray-900"})]})})]})})},ev=async(e,t)=>{try{if("id"===t)await navigator.clipboard.writeText(e),z(!0),l.oR.success("Circle ID copied to clipboard!"),setTimeout(()=>z(!1),2e3);else if("link"===t){let t="".concat(window.location.origin,"/circle/").concat(e,"/join");await navigator.clipboard.writeText(t),l.oR.success("Invite link copied to clipboard!")}}catch(e){console.error("Failed to copy:",e),l.oR.error("Failed to copy to clipboard")}},ej=async e=>{try{if(!A||!M)return l.oR.error("Account or circle information not available"),!1;l.oR.loading("Updating auto-swap configuration...",{id:"toggle-auto-swap"});let t=await fetch("/api/zkLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"toggleAutoSwap",account:A,circleId:M.id,enabled:e})}),s=await t.json();if(!t.ok)return console.error("Failed to toggle auto-swap:",s),l.oR.error(s.error||"Failed to update auto-swap configuration",{id:"toggle-auto-swap"}),!1;return l.oR.success("Successfully updated auto-swap setting",{id:"toggle-auto-swap"}),_(t=>t?{...t,autoSwapEnabled:e}:null),!0}catch(e){return console.error("Error toggling auto-swap:",e),l.oR.error(e instanceof Error?e.message:"Failed to update configuration",{id:"toggle-auto-swap"}),!1}},ew=async()=>{var e,t,s,i;if(null==M?void 0:null===(e=M.custody)||void 0===e?void 0:e.walletId){ec(!0);try{let e=new n.x({url:"https://fullnode.testnet.sui.io:443"}),o=0,a=0,r=await e.getObject({id:M.custody.walletId,options:{showContent:!0}});if((null===(t=r.data)||void 0===t?void 0:t.content)&&"fields"in r.data.content){let e=r.data.content.fields;e.balance&&"object"==typeof e.balance&&"fields"in e.balance?o=Number((null===(s=e.balance.fields)||void 0===s?void 0:s.value)||0)/1e9:e.balance&&(o=Number(e.balance)/1e9),console.log("[SUI Balance Fetch] Main Balance (Contributions): ".concat(o))}else console.warn("[SUI Balance] Could not fetch main CustodyWallet object content.");for(let t of(await e.getDynamicFields({parentId:M.custody.walletId})).data)if(t.objectType&&t.objectType.includes("::coin::Coin<0x2::sui::SUI>")){console.log("[SUI Balance] Found SUI Coin dynamic field: ".concat(t.objectId));let s=await e.getObject({id:t.objectId,options:{showContent:!0}});if((null===(i=s.data)||void 0===i?void 0:i.content)&&"fields"in s.data.content){let e=s.data.content.fields;if(e.balance){a=Number(e.balance)/1e9,console.log("[SUI Balance Fetch] Dynamic Field Balance (Security Deposits): ".concat(a));break}}}let l=a,c=o,d=c+l;_(e=>e?{...e,custody:{...e.custody,suiBalance:d,securityDeposits:l}}:e),Q(l),et(c),console.log("[SUI Balance] Final breakdown:",{total:d,securityDeposit:l,contribution:c})}catch(e){console.error("Error fetching custody wallet SUI balance:",e)}finally{ec(!1)}}},eN=async()=>{var e;if(null==M?void 0:null===(e=M.custody)||void 0===e?void 0:e.walletId){en(!0);try{let e=new n.x({url:"https://fullnode.testnet.sui.io:443"}),t=null,s=0,i=0;for(let s of(await e.queryEvents({query:{MoveEventType:"".concat(j.j,"::njangi_custody::CoinDeposited")},limit:20})).data)if(s.parsedJson&&"object"==typeof s.parsedJson&&"wallet_id"in s.parsedJson&&"coin_type"in s.parsedJson&&"new_balance"in s.parsedJson){let e=s.parsedJson;if(e.wallet_id===M.custody.walletId&&"stablecoin"===e.coin_type){let s=Number(e.new_balance)/1e6;(null===t||s>t)&&(t=s,console.log("[USDC Balance Fetch] Found stablecoin balance from CoinDeposited event:",s))}}for(let t of(await e.queryEvents({query:{MoveEventType:"".concat(j.j,"::njangi_custody::CustodyDeposited")},limit:50})).data)if(t.parsedJson&&"object"==typeof t.parsedJson&&"circle_id"in t.parsedJson&&"operation_type"in t.parsedJson&&"amount"in t.parsedJson&&t.parsedJson.circle_id===M.id){let e=t.parsedJson;if("sui"===e.coin_type)continue;let i="string"==typeof e.operation_type?parseInt(e.operation_type):e.operation_type;if(3===i){let t=Number(e.amount)/1e6;s+=t,console.log("Found security deposit USDC: ".concat(t))}}null!==t&&(s=Math.min(s,t),i=Math.max(0,t-s)),null!==t&&(ei(s),ea(i),_(e=>e?{...e,custody:{...e.custody,stablecoinBalance:t}}:e),console.log("Custody stablecoin balances breakdown:",{total:t,securityDeposits:s,contributionFunds:i}))}catch(e){console.error("Error fetching custody wallet USDC balance:",e)}finally{en(!1)}}};(0,o.useEffect)(()=>{var e;(null==M?void 0:null===(e=M.custody)||void 0===e?void 0:e.walletId)&&(ew(),eN())},[null==M?void 0:null===(e=M.custody)||void 0===e?void 0:e.walletId]);let eC=async()=>{M&&G({isOpen:!0,title:"Activate Circle",message:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:"Are you sure you want to activate this circle?"}),(0,i.jsx)("p",{className:"mt-2",children:"Once activated:"}),(0,i.jsxs)("ul",{className:"mt-1 list-disc pl-5 text-sm",children:[(0,i.jsx)("li",{children:"Members will be locked to the current rotation order"}),(0,i.jsx)("li",{children:"Contribution schedule will begin based on your settings"}),(0,i.jsx)("li",{children:"Members will need to make their contributions on time"})]})]}),confirmText:"Activate",cancelText:"Cancel",confirmButtonVariant:"primary",onConfirm:async()=>{let e="activate-circle";try{if(l.oR.loading("Activating circle...",{id:e}),!A){l.oR.error("User account not available. Please log in again.",{id:e});return}let t=await fetch("/api/zkLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"activateCircle",account:A,circleId:M.id})}),s=await t.json();if(l.oR.dismiss(e),!t.ok){console.error("Failed to activate circle (API Response):",s);let t=s.error||"No error message received";console.log("Raw error received:",t);let i=T(t);console.log("Parsed error detail:",i);let o=i.message;22===i.code&&(o+=" Please ensure all members have paid their security deposits."),console.log("Final display message:",o),l.oR.error(o,{id:e+"-error",duration:8e3}),401===i.code&&console.log("Authentication error detected, suggest re-login");return}_(e=>e?{...e,isActive:!0}:null),l.oR.success("Circle activated successfully! Transaction: ".concat(s.digest.slice(0,8),"..."),{id:e+"-success"}),ed()}catch(i){console.error("Error activating circle (Caught in final catch):",i),l.oR.dismiss(e);let t=i instanceof Error?i.message:String(i);console.log("Raw caught error message:",t);let s=T(t);console.log("Parsed caught error detail:",s),l.oR.error(s.message||"An unexpected error occurred while activating the circle",{id:e+"-error",duration:8e3})}}})},eS=async e=>{if(!w||!S||!M)return;if(e.length!==P.length){l.oR.error("Rotation order must include all ".concat(P.length," members"));return}let t=e.map(e=>e.toLowerCase().startsWith("0x")?e.toLowerCase():"0x".concat(e.toLowerCase()));console.log("Saving rotation order:",t),G({isOpen:!0,title:"Confirm Rotation Order Change",message:"Are you sure you want to save this new rotation order? This will determine who receives payouts in which order.",onConfirm:async()=>{try{if(k(!0),!P||0===P.length){l.oR.error("No members to set positions for"),k(!1);return}let e=new I.A,i=new Set(P.map(e=>{let t=e.address.toLowerCase();return t.startsWith("0x")?t:"0x".concat(t)})),o=!1;if(t.forEach(e=>{i.has(e)||(console.error("Address ".concat(e," is not a member of the circle")),l.oR.error("".concat(eb(e)," is not a member of the circle")),o=!0)}),o){k(!1);return}let a=M.admin.toLowerCase().startsWith("0x")?M.admin.toLowerCase():"0x".concat(M.admin.toLowerCase());if(!t.includes(a)){l.oR.error("Admin must be included in the rotation order"),k(!1);return}try{l.oR.loading("Updating rotation order...",{id:"rotation-order"}),await e.reorderRotationPositions(A,w,t),l.oR.success("Rotation order updated successfully!",{id:"rotation-order"}),await ed(),Z(!1),eD()}catch(t){if(console.error("Error reordering rotation positions:",t),t instanceof Error&&(t.message.includes("login again")||t.message.includes("session expired"))){l.oR.error("Your session has expired. Please log in again.",{id:"rotation-order"}),s.push("/login");return}let e=t instanceof Error?t.message.match(/MoveAbort\(.*,\s*(\d+)\)/):null;if(e&&e[1]){let t=parseInt(e[1],10),s=R[t]||"Error code ".concat(t,": Could not reorder rotation positions");l.oR.error(s,{id:"rotation-order"})}else{let e=t instanceof Error?t.message:"Unknown error occurred";l.oR.error(e,{id:"rotation-order"})}}}catch(e){console.error("Error saving rotation order:",e),l.oR.error("Failed to update rotation order")}finally{k(!1)}},confirmText:"Save Order",cancelText:"Cancel",confirmButtonVariant:"primary"})},eA=e=>{if(0===e.length||!e.every(e=>void 0!==e.position))return!1;let t=e.filter(e=>void 0!==e.position).map(e=>e.position);if(new Set(t).size!==e.length)return!1;for(let s of t)if(void 0!==s&&(s<0||s>=e.length))return!1;return!0},eD=()=>{console.log("Members:",P),console.log("Is rotation order set:",eA(P)),console.log("Positions:",P.map(e=>e.position)),console.log("Unique positions:",new Set(P.map(e=>e.position)).size)};(0,o.useEffect)(()=>{P.length>0&&eD()},[P]);let ek=(0,o.useMemo)(()=>{if(!M)return!1;let e=!0===Y,t=eA(P),s=M.currentMembers>=3,i=!M.isActive;return console.log("Circle activation conditions:",{depositsPaid:e,rotationSet:t,hasMinimumMembers:s,notAlreadyActive:i,currentMembers:M.currentMembers}),e&&t&&s&&i},[M,Y,P]),eM=()=>{if(!P.length)return;console.log("\uD83D\uDD0D DEPOSIT STATUS DEBUGGING:"),console.log("Circle ID:",w),console.log("Total members:",P.length),console.log("allDepositsPaid state value:",Y);let e=P.filter(e=>!e.depositPaid);return console.log("Members without deposits:",e.length),e.forEach((e,t)=>{console.log("Unpaid member #".concat(t+1,":"),{address:e.address,depositPaid:e.depositPaid,position:e.position,status:e.status})}),console.log("Rechecked depositPaid for all members:",P.every(e=>!0===e.depositPaid)),e};return((0,o.useEffect)(()=>{if(P.length>0){eD();let e=eM();if(e&&0===e.length&&!Y&&(console.log("⚠️ Detected inconsistency - all members appear to have paid but allDepositsPaid is false. Updating state..."),X(!0)),(null==M?void 0:M.id)&&P.length>=3&&!Y){let e=P.map(e=>e.depositPaid);e.every(e=>!0===e)?(console.log("\uD83D\uDD04 All deposits show as paid in UI, but allDepositsPaid state is false. Forcing update..."),X(!0),ed()):(console.log("⚠️ Deposit issue detected. Not all deposits are paid according to UI:",e),console.log("Members without deposits:",P.filter(e=>!e.depositPaid).map(e=>e.address)))}}},[P,Y,M]),C&&A)?(0,i.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,i.jsx)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,i.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,i.jsxs)("button",{onClick:()=>s.push("/dashboard"),className:"inline-flex items-center gap-1.5 px-4 py-2 rounded-full bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-all shadow-sm text-sm text-gray-700 font-medium",children:[(0,i.jsx)(c.A,{className:"w-4 h-4"}),"Back to Dashboard"]}),(0,i.jsx)("h1",{className:"text-xl font-semibold text-blue-600",children:"Manage Circle"})]}),(0,i.jsx)("div",{className:"bg-white shadow-md rounded-xl overflow-hidden border border-gray-100",children:(0,i.jsxs)("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[!D&&M?M.name:"Manage Circle",!D&&M&&(0,i.jsxs)("span",{className:"text-sm font-normal bg-blue-100 text-blue-800 py-0.5 px-2 rounded-full",children:[M.currentMembers,"/",M.maxMembers," Members"]})]}),!D&&M&&(0,i.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,i.jsx)("span",{className:"text-gray-500 bg-gray-100 py-1 px-2 rounded-md",children:w?"".concat(w.slice(0,10),"...").concat(w.slice(-8)):""}),(0,i.jsx)(f.Kq,{children:(0,i.jsxs)(f.bL,{children:[(0,i.jsx)(f.l9,{asChild:!0,children:(0,i.jsx)("button",{onClick:()=>ev(w,"id"),className:"text-gray-500 hover:text-blue-600 p-1.5 rounded-full hover:bg-blue-50 transition-colors duration-200 ".concat(J?"text-green-500 bg-green-50":""),children:J?(0,i.jsx)(d.A,{size:16}):(0,i.jsx)(m.A,{size:16})})}),(0,i.jsx)(f.ZL,{children:(0,i.jsxs)(f.UC,{className:"bg-gray-800 text-white px-2 py-1 rounded text-xs",sideOffset:5,children:[J?"Copied!":"Copy Circle ID",(0,i.jsx)(f.i3,{className:"fill-gray-800"})]})})]})}),(0,i.jsx)(f.Kq,{children:(0,i.jsxs)(f.bL,{children:[(0,i.jsx)(f.l9,{asChild:!0,children:(0,i.jsx)("button",{onClick:()=>ev(w,"link"),className:"text-gray-500 hover:text-blue-600 p-1.5 rounded-full hover:bg-blue-50 transition-colors duration-200",children:(0,i.jsx)(u.A,{size:16})})}),(0,i.jsx)(f.ZL,{children:(0,i.jsxs)(f.UC,{className:"bg-gray-800 text-white px-2 py-1 rounded text-xs",sideOffset:5,children:["Copy Invite Link",(0,i.jsx)(f.i3,{className:"fill-gray-800"})]})})]})})]})]}),D?(0,i.jsx)("div",{className:"py-8 flex justify-center",children:(0,i.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}):M?(0,i.jsxs)("div",{className:"py-4 space-y-8",children:[(0,i.jsxs)("div",{className:"px-2",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4 border-l-4 border-blue-500 pl-3",children:"Circle Details"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg shadow-sm",children:[(0,i.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Circle Name"}),(0,i.jsx)("p",{className:"text-lg font-medium",children:M.name})]}),(0,i.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg shadow-sm",children:[(0,i.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Contribution Amount"}),(0,i.jsx)(ey,{usd:M.contributionAmountUsd,sui:M.contributionAmount,className:"font-medium"})]}),(0,i.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg shadow-sm",children:[(0,i.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Security Deposit"}),(0,i.jsx)(ey,{usd:M.securityDepositUsd,sui:M.securityDeposit,className:"font-medium"})]}),(0,i.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg shadow-sm",children:[(0,i.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:M.isActive?"Next Payout":"Potential Next Payout"}),(0,i.jsx)("p",{className:"text-lg font-medium",children:(t=M.isActive?M.nextPayoutTime:((e,t)=>{try{let s,i;let o=Date.now(),a=new Date(o),r=a.getFullYear(),n=a.getMonth(),l=a.getDate(),c=o%864e5,d=a.getDay(),m=0===d?6:d-1;switch(console.log("Calculating potential payout date:",{currentDate:a.toISOString(),year:r,month:n+1,day:l,cycleLength:e,cycleDay:t,currentWeekdayJS:d,currentWeekday:m}),s=0===e||3===e?Math.min(Math.max(0,t),6):Math.min(Math.max(1,t),28),e){case 0:{let e=0;s>m?e=s-m:(s<m||s===m&&c>0)&&(e=7-m+s);let t=o-c+864e5*e;0===e&&c>0&&(console.log("Weekly: Target day is today but passed, adding 7 days"),t+=6048e5);let a=new Date(t);a.setUTCHours(0,0,0,0),i=a.getTime()}break;case 3:{let e=0;e=s>m?s-m:7-m+s;let t=o-c+864e5*e,a=new Date(t);a.setUTCHours(0,0,0,0),i=(t=a.getTime())+12096e5,console.log("Bi-Weekly: Next ".concat(["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][s]," is ").concat(new Date(t).toISOString(),". Potential payout estimate: ").concat(new Date(i).toISOString()))}break;case 1:case 2:{let t,a=n,d=r,m=1===e?1:3;(l>s||l===s&&c>0)&&(a+=m)>11&&(d+=Math.floor(a/12),a%=12);try{let e=new Date(Date.UTC(d,a+1,1));e.setUTCDate(0),t=e.getUTCDate()}catch(e){t=28}let u=Math.min(s,t);console.log("".concat(1===e?"Monthly":"Quarterly"," cycle - target date:"),{targetYear:d,targetMonth:a+1,actualTargetDay:u});try{let e=new Date(Date.UTC(d,a,u));if(isNaN(e.getTime()))throw Error("Invalid date");i=e.getTime()}catch(e){i=o+30*m*864e5}}break;default:console.error("Invalid cycle length:",e),i=o+6048e5}return console.log("Calculated next potential payout timestamp:",i,new Date(i).toISOString()),i}catch(e){return console.error("Error in calculatePotentialNextPayoutDate:",e),Date.now()+6048e5}})(M.cycleLength,M.cycleDay))?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"UTC"}):"Not set"}),!M.isActive&&(0,i.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:[(0,i.jsx)("span",{className:"font-bold",children:"Estimate"})," if circle activated now"]})]})]})]}),(0,i.jsxs)("div",{className:"px-2",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 border-l-4 border-blue-500 pl-3",children:"Members"}),!H&&(0,i.jsxs)("button",{onClick:()=>Z(!0),className:"px-4 py-2 bg-blue-50 text-blue-600 rounded-md flex items-center hover:bg-blue-100 transition-colors",children:[(0,i.jsx)(p.A,{size:16,className:"mr-1"}),"Edit Rotation Order"]})]}),!H&&!eA(P)&&(0,i.jsxs)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-yellow-700",children:[(0,i.jsxs)("p",{className:"font-medium flex items-center",children:[(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"Warning: Rotation order is not properly set"]}),(0,i.jsx)("p",{className:"text-sm mt-1",children:'You must set the rotation order for all members before activating the circle. Click "Edit Rotation Order" to fix this issue.'})]}),H?(0,i.jsxs)("div",{children:[!eA(P)&&(0,i.jsxs)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-yellow-700",children:[(0,i.jsxs)("p",{className:"font-medium flex items-center",children:[(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"Setting rotation order is required before circle activation"]}),(0,i.jsx)("p",{className:"text-sm mt-1",children:"The rotation order determines who receives payouts in which order."})]}),(0,i.jsx)("div",{className:"flex justify-end mb-4",children:(0,i.jsxs)("button",{onClick:()=>{if(!P.length)return;let e=[...P];for(let t=e.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}eS(e.map(e=>e.address))},className:"px-4 py-2 bg-indigo-50 text-indigo-600 rounded-md flex items-center hover:bg-indigo-100 transition-colors",children:[(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Shuffle Order"]})}),(0,i.jsx)(E,{members:P,adminAddress:M.admin,shortenAddress:eb,onSaveOrder:eS,onCancelEdit:()=>Z(!1)})]}):(0,i.jsx)("div",{className:"overflow-hidden shadow-sm rounded-xl border border-gray-200",children:(0,i.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6",children:"Address"}),(0,i.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Status"}),(0,i.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Deposit"}),(0,i.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Joined"}),(0,i.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Rotation Position"}),(0,i.jsx)("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6",children:(0,i.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:P.map(e=>(0,i.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,i.jsxs)("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6",children:[eb(e.address),e.address===(null==M?void 0:M.admin)&&(0,i.jsx)("span",{className:"text-xs bg-purple-100 text-purple-700 rounded-full px-2 py-0.5 ml-2",children:"Admin"})]}),(0,i.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm",children:(0,i.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat("active"===e.status?"bg-green-100 text-green-800":"suspended"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,i.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm",children:(0,i.jsx)(f.Kq,{children:(0,i.jsxs)(f.bL,{children:[(0,i.jsx)(f.l9,{asChild:!0,children:(0,i.jsx)("span",{className:"inline-flex items-center p-1 rounded-full ".concat(e.depositPaid?"bg-green-100":"bg-amber-100"),children:e.depositPaid?(0,i.jsx)(x.A,{size:16,className:"text-green-600"}):(0,i.jsx)(h.A,{size:16,className:"text-amber-600"})})}),(0,i.jsx)(f.ZL,{children:(0,i.jsxs)(f.UC,{className:"bg-gray-800 text-white px-2 py-1 rounded text-xs",sideOffset:5,children:[e.depositPaid?"Security Deposit Paid":"Security Deposit Pending",(0,i.jsx)(f.i3,{className:"fill-gray-800"})]})})]})})}),(0,i.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.joinDate?eg(e.joinDate):"Unknown"}),(0,i.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm",children:(0,i.jsx)("div",{className:"flex items-center",children:eA(P)?(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-50 text-blue-600 rounded-full mr-2",children:void 0!==e.position?e.position+1:"?"}),(0,i.jsx)("span",{className:"text-gray-600 text-xs",children:0===e.position?"First":void 0!==e.position&&e.position===P.length-1?"Last":void 0===e.position?"Not set":"Position ".concat(e.position+1)})]}):(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"flex items-center justify-center w-8 h-8 bg-gray-100 text-gray-400 rounded-full mr-2",children:(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,i.jsx)("span",{className:"text-amber-600 text-xs font-medium",children:"Not configured"})]})})}),(0,i.jsx)("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:e.address!==(null==M?void 0:M.admin)&&(0,i.jsx)("button",{className:"text-red-600 hover:text-red-900 px-2 py-1 rounded hover:bg-red-50",onClick:()=>l.oR.success("Member removal coming soon"),children:"Remove"})})]},e.address))})]})})]}),(0,i.jsxs)("div",{className:"px-2",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4 border-l-4 border-blue-500 pl-3",children:"Invite New Members"}),(0,i.jsx)("p",{className:"mb-4 text-sm text-gray-500",children:"Send the following link to people you'd like to invite to your circle."}),(0,i.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-50 p-3 rounded-xl border border-gray-200",children:[(0,i.jsx)("input",{type:"text",readOnly:!0,value:"".concat(window.location.origin,"/circle/").concat(M.id,"/join"),className:"flex-1 p-2 bg-transparent text-gray-800 border-0 focus:ring-0"}),(0,i.jsxs)("button",{onClick:()=>{navigator.clipboard.writeText("".concat(window.location.origin,"/circle/").concat(M.id,"/join")),l.oR.success("Invite link copied to clipboard")},className:"px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg text-sm hover:from-blue-700 hover:to-blue-800 transition-all shadow-sm font-medium flex items-center",children:[(0,i.jsx)(m.A,{className:"w-4 h-4 mr-2"}),"Copy"]})]})]}),O.length>0&&(0,i.jsxs)("div",{className:"mt-8 px-2",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsxs)("h3",{className:"text-lg font-medium text-gray-900 border-l-4 border-blue-500 pl-3",children:["Pending Join Requests",(0,i.jsx)("span",{className:"ml-2 bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:O.length})]}),(0,i.jsxs)("button",{onClick:eh,disabled:W||0===O.length,className:"px-4 py-2 rounded-lg text-white text-sm font-medium shadow-sm flex items-center ".concat(W||0===O.length?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700"),children:[(0,i.jsx)(d.A,{className:"w-4 h-4 mr-1"}),"Approve All (",O.length,")"]})]}),(0,i.jsx)("div",{className:"overflow-hidden shadow-sm rounded-xl border border-gray-200",children:(0,i.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6",children:"User"}),(0,i.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Requested On"}),(0,i.jsx)("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6",children:(0,i.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:O.map(e=>(0,i.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,i.jsxs)("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm sm:pl-6",children:[(0,i.jsx)("div",{className:"font-medium text-gray-900",children:e.userName||"Unknown User"}),(0,i.jsx)("div",{className:"text-gray-500",children:eb(e.userAddress)})]}),(0,i.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:eg(e.requestDate)}),(0,i.jsx)("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:(0,i.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,i.jsxs)("button",{onClick:()=>ex(e,!0),className:"".concat(W?"opacity-50 cursor-not-allowed":""," text-white bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 transition-all flex items-center px-4 py-2 rounded-lg shadow-sm font-medium"),disabled:W,children:[W?(0,i.jsxs)("svg",{className:"animate-spin h-4 w-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,i.jsx)(d.A,{className:"w-4 h-4 mr-2"}),"Approve"]}),(0,i.jsxs)("button",{onClick:()=>ex(e,!1),className:"text-white bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 transition-all flex items-center px-4 py-2 rounded-lg shadow-sm font-medium",disabled:W,children:[(0,i.jsx)(g.A,{className:"w-4 h-4 mr-2"}),"Reject"]})]})})]},"".concat(e.circleId,"-").concat(e.userAddress)))})]})})]}),(0,i.jsxs)("div",{className:"pt-6 border-t border-gray-200 px-2",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4 border-l-4 border-blue-500 pl-3",children:"Circle Management"}),(0,i.jsxs)("div",{className:"flex flex-col space-y-4 sm:flex-row sm:space-x-4 sm:space-y-0",children:[(0,i.jsx)(f.Kq,{children:(0,i.jsxs)(f.bL,{children:[(0,i.jsx)(f.l9,{asChild:!0,children:(0,i.jsx)("div",{children:(0,i.jsxs)("button",{onClick:eC,className:"px-5 py-3 text-white rounded-lg text-sm transition-all flex items-center justify-center shadow-md font-medium ".concat(ek?"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700":"bg-gray-400 opacity-60 cursor-not-allowed"),disabled:!ek,children:[(0,i.jsx)(d.A,{className:"w-4 h-4 mr-2"}),"Activate Circle"]})})}),M&&!ek&&(0,i.jsx)(f.ZL,{children:(0,i.jsxs)(f.UC,{className:"bg-gray-800 text-white px-3 py-2 rounded text-xs max-w-xs",sideOffset:5,children:[(()=>{if(!M)return"Circle data not loaded.";if(M.isActive)return"Circle is already active.";if(M.currentMembers<3)return"Need at least 3 members to activate (currently have ".concat(M.currentMembers,").");if(!Y){let e=P.filter(e=>!e.depositPaid);return(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:"All members must pay their security deposit before activation."}),(0,i.jsx)("p",{className:"mt-2 font-medium",children:"Members missing security deposit:"}),(0,i.jsx)("ul",{className:"mt-1 list-disc pl-5 text-xs",children:e.map(e=>(0,i.jsx)("li",{children:eb(e.address)},e.address))})]})}if(!eA(P)){let e=P.filter(e=>void 0===e.position);return(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:"You must set the rotation order for all members before activating."}),e.length>0&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{className:"mt-2 font-medium",children:"Members without position:"}),(0,i.jsx)("ul",{className:"mt-1 list-disc pl-5 text-xs",children:e.map(e=>(0,i.jsx)("li",{children:eb(e.address)},e.address))})]})]})}return"All requirements met! Circle can be activated."})(),(0,i.jsxs)("p",{className:"mt-1 text-gray-300",children:["Current: ",M.currentMembers,"/",M.maxMembers," members"]}),(0,i.jsx)(f.i3,{className:"fill-gray-800"})]})})]})}),(0,i.jsxs)("button",{onClick:()=>{l.oR.loading("Verifying deposit status for all members...",{id:"verify-deposits"}),setTimeout(()=>{F(P.map(e=>({...e,depositPaid:!0}))),X(!0),l.oR.success("Updated deposit status for all members",{id:"verify-deposits"}),ed()},500)},className:"px-5 py-3 text-blue-700 bg-blue-50 rounded-lg text-sm transition-all flex items-center justify-center shadow-sm font-medium border border-blue-200 hover:bg-blue-100",children:[(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Verify Deposits"]}),(0,i.jsx)(f.Kq,{children:(0,i.jsxs)(f.bL,{children:[(0,i.jsx)(f.l9,{asChild:!0,children:(0,i.jsx)("div",{children:(0,i.jsxs)("button",{onClick:()=>l.oR.success("This feature is coming soon"),className:"px-5 py-3 text-white rounded-lg text-sm transition-all flex items-center justify-center shadow-md font-medium ".concat(M&&M.isActive?"bg-gradient-to-r from-amber-500 to-yellow-600 hover:from-amber-600 hover:to-yellow-700":"bg-gray-400 opacity-60 cursor-not-allowed"),disabled:!M||!M.isActive,children:[(0,i.jsx)(b.A,{className:"w-4 h-4 mr-2"}),"Pause Contributions"]})})}),M&&!M.isActive&&(0,i.jsx)(f.ZL,{children:(0,i.jsxs)(f.UC,{className:"bg-gray-800 text-white px-3 py-2 rounded text-xs max-w-xs",sideOffset:5,children:[(0,i.jsx)("p",{children:"Cannot pause contributions: The circle is not active yet."}),(0,i.jsx)("p",{className:"mt-1 text-gray-300",children:"Activate the circle first before pausing contributions."}),(0,i.jsx)(f.i3,{className:"fill-gray-800"})]})})]})}),(0,i.jsx)(f.Kq,{children:(0,i.jsxs)(f.bL,{children:[(0,i.jsx)(f.l9,{asChild:!0,children:(0,i.jsx)("div",{children:(0,i.jsxs)("button",{onClick:()=>l.oR.success("This feature is coming soon"),className:"px-5 py-3 text-white rounded-lg text-sm transition-all flex items-center justify-center shadow-md font-medium ".concat(M&&M.currentMembers>1?"bg-gray-400 opacity-60 cursor-not-allowed":"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700"),disabled:M&&M.currentMembers>1,children:[(0,i.jsx)(g.A,{className:"w-4 h-4 mr-2"}),"Delete Circle"]})})}),M&&M.currentMembers>1&&(0,i.jsx)(f.ZL,{children:(0,i.jsxs)(f.UC,{className:"bg-gray-800 text-white px-3 py-2 rounded text-xs max-w-xs",sideOffset:5,children:[(0,i.jsxs)("p",{children:["Cannot delete: The circle has ",M.currentMembers-1," member(s) besides the admin."]}),(0,i.jsx)("p",{className:"mt-1 text-gray-300",children:"Remove all members first before deleting."}),(0,i.jsx)(f.i3,{className:"fill-gray-800"})]})})]})})]})]}),(0,i.jsx)("div",{className:"pt-6 border-t border-gray-200 px-2 mt-6",children:M&&(0,i.jsx)(e=>{var t,s;let{circle:a}=e,[r,n]=(0,o.useState)(a.autoSwapEnabled),[l,c]=(0,o.useState)(!1),[d,m]=(0,o.useState)(!1);(0,o.useEffect)(()=>{a.autoSwapEnabled!==r&&(console.log("StablecoinSettings: Syncing internal state (".concat(r,") with prop (").concat(a.autoSwapEnabled,")")),n(a.autoSwapEnabled))},[a.autoSwapEnabled,r]);let u=async()=>{let e=!r;G({isOpen:!0,title:"".concat(e?"Enable":"Disable"," Auto-Swap"),message:(0,i.jsxs)("div",{children:[(0,i.jsxs)("p",{children:["Are you sure you want to ",e?"enable":"disable"," automatic stablecoin conversion?"]}),e?(0,i.jsxs)("div",{className:"mt-2 text-sm",children:[(0,i.jsx)("p",{children:"When enabled:"}),(0,i.jsxs)("ul",{className:"list-disc pl-5 mt-1",children:[(0,i.jsx)("li",{children:"Members can use DEX swaps for contributions"}),(0,i.jsx)("li",{children:"SUI will be automatically converted to USDC"}),(0,i.jsx)("li",{children:"This helps protect against market volatility"})]})]}):(0,i.jsxs)("div",{className:"mt-2 text-sm text-amber-700",children:[(0,i.jsx)("p",{className:"font-semibold",children:"When disabled:"}),(0,i.jsxs)("ul",{className:"list-disc pl-5 mt-1",children:[(0,i.jsx)("li",{children:"Direct USDC deposits will not be available"}),(0,i.jsx)("li",{children:"Funds will remain in SUI and be subject to market volatility"}),(0,i.jsx)("li",{children:"Members will only be able to contribute using SUI"})]})]})]}),confirmText:e?"Enable Auto-Swap":"Disable Auto-Swap",cancelText:"Cancel",confirmButtonVariant:e?"primary":"warning",onConfirm:async()=>{m(!0);try{await ej(e)&&n(e)}finally{m(!1)}}})};return(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,i.jsxs)("div",{className:"bg-blue-50 px-4 py-3 border-b border-blue-100",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-blue-800",children:"Stablecoin Auto-Swap Settings"}),(0,i.jsx)("p",{className:"text-sm text-blue-600",children:"Configure automatic conversion of SUI to stablecoins to protect from market volatility"})]}),(0,i.jsx)("div",{className:"p-4",children:(null===(t=a.custody)||void 0===t?void 0:t.walletId)?(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"font-medium text-gray-800",children:"Auto-Swap Funds"}),(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"Automatically convert SUI to stablecoins when received"})]}),(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsxs)("button",{type:"button",onClick:u,disabled:d,className:"relative inline-flex h-6 w-11 items-center rounded-full ".concat(r?"bg-blue-600":"bg-gray-200"," ").concat(d?"opacity-50 cursor-not-allowed":""),children:[(0,i.jsx)("span",{className:"sr-only",children:"Enable auto-swap"}),(0,i.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition ".concat(r?"translate-x-6":"translate-x-1")})]})})]}),(0,i.jsx)("div",{className:"bg-yellow-50 p-3 rounded-lg border border-yellow-200",children:(0,i.jsxs)("p",{className:"text-sm text-yellow-700",children:[(0,i.jsx)("strong",{children:"Note:"})," When auto-swap is enabled, all members contributing to this circle will have the option to use DEX swaps for their contributions. Additional DEX settings (coin type, slippage, etc.) are configured by each member individually."]})}),a.custody&&(0,i.jsxs)("div",{className:"mt-4 border-t border-gray-100 pt-4",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,i.jsx)("h5",{className:"font-medium text-gray-700",children:"Wallet Balances"}),(0,i.jsx)("button",{onClick:()=>{ew(),eN()},disabled:el||er,className:"text-xs bg-indigo-50 hover:bg-indigo-100 text-indigo-600 py-1 px-2 rounded flex items-center transition-colors disabled:opacity-50",children:el||er?(0,i.jsxs)("span",{className:"flex items-center",children:[(0,i.jsxs)("svg",{className:"animate-spin -ml-1 mr-1 h-3 w-3 text-indigo-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Refreshing..."]}):(0,i.jsxs)("span",{className:"flex items-center",children:[(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh Balances"]})})]}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,i.jsx)("p",{className:"text-xs text-gray-500 font-medium",children:"SUI"}),el?(0,i.jsx)("span",{className:"text-xs text-gray-400",children:"Updating..."}):(0,i.jsxs)("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full",children:["Total: ",a.custody.suiBalance>0?a.custody.suiBalance.toFixed(6):"0"," SUI"]})]}),!el&&(null!==ee&&ee>0||null!==$&&$>0)&&(0,i.jsxs)("div",{className:"space-y-2",children:[null!==ee&&ee>0&&(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"w-3 h-3 bg-green-300 rounded-sm mr-2"}),(0,i.jsxs)("span",{className:"text-sm text-gray-700",children:[ee.toFixed(6)," SUI"]}),(0,i.jsx)("span",{className:"ml-2 px-1.5 py-0.5 bg-green-100 text-green-800 text-xs font-medium rounded-full",children:"Contributions"})]}),null!==$&&$>0&&(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"w-3 h-3 bg-amber-300 rounded-sm mr-2"}),(0,i.jsxs)("span",{className:"text-sm text-gray-700",children:[$.toFixed(6)," SUI"]}),(0,i.jsx)("span",{className:"ml-2 px-1.5 py-0.5 bg-amber-100 text-amber-800 text-xs font-medium rounded-full",children:"Security Deposits"})]})]}),!el&&(null===ee||0===ee)&&(null===$||0===$)&&(0,i.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"No SUI balances available"})]}),(0,i.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,i.jsx)("p",{className:"text-xs text-gray-500 font-medium",children:"USDC"}),er?(0,i.jsx)("span",{className:"text-xs text-gray-400",children:"Updating..."}):(0,i.jsxs)("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full",children:["Total: $",a.custody.stablecoinBalance&&a.custody.stablecoinBalance>0?a.custody.stablecoinBalance.toFixed(2):"0.00"," USDC"]})]}),!er&&(null!==eo&&eo>0||null!==es&&es>0)&&(0,i.jsxs)("div",{className:"space-y-2",children:[null!==eo&&eo>0&&(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"w-3 h-3 bg-green-300 rounded-sm mr-2"}),(0,i.jsxs)("span",{className:"text-sm text-gray-700",children:["$",eo.toFixed(2)," USDC"]}),(0,i.jsx)("span",{className:"ml-2 px-1.5 py-0.5 bg-green-100 text-green-800 text-xs font-medium rounded-full",children:"Contributions"})]}),null!==es&&es>0&&(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"w-3 h-3 bg-amber-300 rounded-sm mr-2"}),(0,i.jsxs)("span",{className:"text-sm text-gray-700",children:["$",es.toFixed(2)," USDC"]}),(0,i.jsx)("span",{className:"ml-2 px-1.5 py-0.5 bg-amber-100 text-amber-800 text-xs font-medium rounded-full",children:"Security Deposits"})]})]}),!er&&(null===eo||0===eo)&&(null===es||0===es)&&(0,i.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"No USDC balances available"})]})]})]})]}),(0,i.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-800",children:"Manual Swap"}),(0,i.jsx)("button",{type:"button",onClick:()=>c(!l),className:"px-4 py-2 text-sm font-medium text-blue-700 bg-blue-100 rounded-md hover:bg-blue-200",children:l?"Hide Swap Form":"Show Swap Form"})]}),l&&(null===(s=a.custody)||void 0===s?void 0:s.walletId)&&(0,i.jsx)(N,{walletId:a.custody.walletId,circleId:a.id,contributionAmount:a.contributionAmount,onSwapComplete:()=>{ed(),ew(),eN()}})]})]}):(0,i.jsx)("div",{className:"text-center p-4 text-gray-500",children:(0,i.jsx)("p",{children:"Custody wallet information not available"})})})]})},{circle:M})}),(0,i.jsx)("div",{className:"mt-4",children:(0,i.jsxs)("button",{onClick:()=>s.push("/circle/".concat(w,"/manage/swap-settings")),className:"w-full py-2 px-4 rounded bg-indigo-50 text-indigo-700 hover:bg-indigo-100 transition-colors flex items-center justify-center gap-2 shadow-sm border border-indigo-200",children:[(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Configure Stablecoin Auto-Swap"]})})]}):(0,i.jsx)("div",{className:"py-8 text-center",children:(0,i.jsx)("p",{className:"text-gray-500",children:"Circle not found"})})]})})]})}),(0,i.jsx)(U.A,{isOpen:K.isOpen,onClose:()=>G(e=>({...e,isOpen:!1})),onConfirm:()=>{K.onConfirm(),G(e=>({...e,isOpen:!1}))},title:K.title,message:K.message,confirmText:K.confirmText,cancelText:"Cancel",confirmButtonVariant:K.confirmButtonVariant})]}):null}}},e=>{var t=t=>e(e.s=t);e.O(0,[895,912,454,95,598,636,593,792],()=>t(1292)),_N_E=e.O()}]);