(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[384],{2275:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/circle/[id]/contribute",function(){return s(6891)}])},6891:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>F});var o=s(4848),i=s(6540),n=s(6715),a=s(3481),r=s(1895),l=s(2636),c=s(3787),d=s(3881),u=s(2876),m=s(6857),p=s(852),b=s(3741),x=s(9279);let f=(0,x.A)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),g=(0,x.A)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);var h=s(4175),y=s(8774),v=s(1438);let j=(0,x.A)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var w=s(6823);let N=e=>{let{walletId:t,circleId:s,contributionAmount:n,securityDepositPaid:c=!0,securityDepositAmount:d=0,onComplete:m,disabled:x=!1}=e;console.log("[SimplifiedSwapUI] Initializing. securityDepositPaid:",c),console.log("[SimplifiedSwapUI] contributionAmount prop:",n),console.log("[SimplifiedSwapUI] securityDepositAmount prop:",d);let N=c?n:d;console.log("[SimplifiedSwapUI] Calculated requiredAmount:",N),console.log("[SimplifiedSwapUI] Setting initial amount state to:",N.toString());let{account:S}=(0,a.A)(),[C,U]=(0,i.useState)(""),[D,I]=(0,i.useState)("0.0"),[_,F]=(0,i.useState)(null),[A,k]=(0,i.useState)(!1),[E,M]=(0,i.useState)(5),[T,R]=(0,i.useState)(""),[P,J]=(0,i.useState)(!1),[q,O]=(0,i.useState)(null),[B,z]=(0,i.useState)(null),[L,Y]=(0,i.useState)(null),[H,W]=(0,i.useState)(null),[$,V]=(0,i.useState)(!1),[X,K]=(0,i.useState)(null),[G,Z]=(0,i.useState)("swap"),[Q,ee]=(0,i.useState)(null),[et,es]=(0,i.useState)(null),[eo,ei]=(0,i.useState)(!1),[en,ea]=(0,i.useState)(0),[er,el]=(0,i.useState)(!1),[ec,ed]=(0,i.useState)(10),[eu,em]=(0,i.useState)(!1),[ep,eb]=(0,i.useState)(!1),ex="0x26b3bc67befc214058ca78ea9a2690298d731a2d4309485ec3d40198063c4abc::usdc::USDC";(0,i.useEffect)(()=>{(async()=>{V(!0);try{let e=u.n.getCachedPrice();null!==e&&(O(e),z(e),K(new Date));let t=await u.n.forceRefreshPrice();if(t&&!isNaN(t)&&t>0){if(O(t),z(t),K(new Date),console.log("Fetched fresh SUI price:",t),C&&parseFloat(C)>0){let e=parseFloat(C)*t;I(e.toFixed(2))}N>0&&ef(N,t,E)}else null===e&&(console.warn("Using fallback SUI price of $3.71"),O(3.71),z(3.71),K(new Date))}catch(e){console.error("Error fetching SUI price:",e),null===q&&(O(3.71),z(3.71),K(new Date))}finally{V(!1)}})()},[]),(0,i.useEffect)(()=>{N>0&&(U(N.toString()),eh(N.toString()),q&&ef(N,q,E))},[N,q]),(0,i.useEffect)(()=>{N>0&&q&&ef(N,q,E)},[E,N]),(0,i.useEffect)(()=>{if(N>0&&q){let e=ef(N,q,E);if(W(e),em(5!==E),C&&parseFloat(C)>0&&H){let t=parseFloat(C);if(.05>Math.abs((t-H)/H)&&(console.log("Updating amount based on slippage change: ".concat(t," → ").concat(e)),U(e.toString()),q)){let t=.97;c||(t=.95),e<.2&&(t-=.03);let s=e*q*t;if(I(s.toFixed(6)),_){let t={..._};t.amountIn=e,t.amountOut=1e6*s,F(t)}}}}},[E]);let ef=(e,t,s)=>{if(!t||t<=0||!e||e<=0)return e;let o=!c,i=e*t;console.log("Target USDC amount: ".concat(i.toFixed(6)," USDC"));let n=s/100;o&&(n=Math.max(n,.25),console.log("Using security deposit buffer: ".concat(100*n,"%"))),n+=.1,e<.2&&(n+=.2,console.log("Adding small amount buffer, total buffer: ".concat(100*n,"%")));let a=e/(1-(n=Math.max(n,.07))),r=a+21e-5;return console.log("Calculation details:",{baseSuiAmount:e,targetUsdcAmount:i.toFixed(6),bufferPercentage:(100*n).toFixed(2)+"%",adjustedSuiAmount:a.toFixed(8),withGasFee:r.toFixed(8)}),W(r),r},eg=e=>{if(!N||N<=0){Y(null);return}let t=(e-N)/N*100;.1>Math.abs(t)?Y("exact"):t<0?Y("underpaid"):Y("overpaid")},eh=async e=>{if(!e||0>=parseFloat(e)){I("0.0"),F(null),Y(null);return}if(!s){l.oR.error("Circle ID is required for swap estimation");return}let t=parseFloat(e);eg(t);try{if(q&&q>0){let e=.97;!c&&N>0&&(e=.95),t<.2&&(e-=.03);let s=t*q*e,o={amountIn:t,amountOut:1e6*s,price:q*e,priceImpact:.1+(1-e)*100,poolId:"live-price"};if(F(o),I(s.toFixed(6)),z(q*e),!c&&N>0){let e=N*q;s<e&&!A&&console.warn("Estimated USDC (".concat(s.toFixed(6),") may be less than required (").concat(e.toFixed(6),")"))}return}let e=await p.v3.getSwapEstimate("0x2::sui::SUI",ex,t,s);if(e){F(e),I((e.amountOut/1e6).toFixed(2));let t=e.amountOut/(1e6*e.amountIn);z(t)}else I("0.0"),z(null)}catch(e){console.error("Error in getSwapEstimate:",e),l.oR.error("Failed to get swap estimate"),I("0.0"),z(null)}},ey=e=>{if(q&&q>0){let t=e/q;U(t.toFixed(18)),I(e.toFixed(2)),F({amountIn:t,amountOut:1e6*e,price:q,priceImpact:.1,poolId:"live-price"}),z(q),eg(t)}};(0,i.useEffect)(()=>{q&&q>0&&(!C||0===parseFloat(C))&&!N&&ey(1)},[q]);let ev=async()=>{if(!_||!S||!C){l.oR.error("Please enter an amount to swap");return}k(!0);try{l.oR.dismiss("swap-step"),l.oR.loading("Processing SUI to USDC swap...",{id:"swap-step"});let e=E;if(!c&&N>0&&null!==q&&q>0){let t=N*q*1e6;console.log("For security deposit: Required minimum USDC: ".concat(t/1e6," USDC (").concat(t," microunits)"));let s=Math.floor(t),o=Math.floor(_.amountOut*(1-1.1*e/100)),i=Math.min(s,o);console.log("Min amount out calculation:",{standard:o,floor:s,using:i});let n=parseFloat(C);console.log("Sending swap-only request with detailed parameters:",{suiAmount:n,quoteAmountOut:_.amountOut,minAmountOut:i,slippage:e,priceImpact:_.priceImpact});let a=await fetch("/api/zkLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"executeSwapOnly",account:S,suiAmount:n,minAmountOut:i,slippage:e})}),r=await a.json();if(!a.ok){if(console.error("Swap failed:",r),r.requireRelogin){l.oR.error("Your session has expired. Please login again.",{id:"swap-step"}),setTimeout(()=>{window.location.href="/"},2e3);return}let e=r.error||"Swap failed";if(r.details&&(console.error("Error details:",r.details),"string"==typeof r.details)){if(r.details.includes("insufficient gas"))e="Insufficient SUI for gas fees. Please add more SUI to your wallet.",l.oR.error(e,{id:"swap-step"});else if(r.details.includes("coin balance too low"))e="Your wallet balance is too low for this swap.",l.oR.error(e,{id:"swap-step"});else if(r.details.includes("function not found"))e="Swap failed: Cetus pool module not found. Please contact support.",l.oR.error(e,{id:"swap-step"});else if(r.details.includes("Pool does not exist"))e="The SUI/USDC liquidity pool is not available. Please try again later.",l.oR.error(e,{id:"swap-step"});else if(r.details.includes("Slippage tolerance exceeded")||r.details.includes("MoveAbort")&&r.details.includes("1) in command 2")){let e=Math.min(50,Math.ceil(2*E));l.oR.dismiss("swap-step"),ed(e),el(!0),k(!1);return}}throw Error(e)}l.oR.success("SUI to USDC swap completed successfully!",{id:"swap-step"}),console.log("Swap transaction executed with digest:",r.digest),ee(r.digest),es(r.createdCoinId),Z("deposit")}else{e=1.2*E,console.log("Using effective slippage of ".concat(e,"% (user selected ").concat(E,"%)"));let t=Math.max(100,Math.floor(_.amountOut*(1-e/100))),s=parseFloat(C);console.log("Sending swap-only request with detailed parameters:",{suiAmount:s,quoteAmountOut:_.amountOut,minAmountOut:t,slippage:e,priceImpact:_.priceImpact});let o=await fetch("/api/zkLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"executeSwapOnly",account:S,suiAmount:s,minAmountOut:t,slippage:e})}),i=await o.json();if(!o.ok){if(console.error("Swap failed:",i),i.requireRelogin){l.oR.error("Your session has expired. Please login again.",{id:"swap-step"}),setTimeout(()=>{window.location.href="/"},2e3);return}let e=i.error||"Swap failed";if(i.details&&(console.error("Error details:",i.details),"string"==typeof i.details)){if(i.details.includes("insufficient gas"))e="Insufficient SUI for gas fees. Please add more SUI to your wallet.",l.oR.error(e,{id:"swap-step"});else if(i.details.includes("coin balance too low"))e="Your wallet balance is too low for this swap.",l.oR.error(e,{id:"swap-step"});else if(i.details.includes("function not found"))e="Swap failed: Cetus pool module not found. Please contact support.",l.oR.error(e,{id:"swap-step"});else if(i.details.includes("Pool does not exist"))e="The SUI/USDC liquidity pool is not available. Please try again later.",l.oR.error(e,{id:"swap-step"});else if(i.details.includes("Slippage tolerance exceeded")||i.details.includes("MoveAbort")&&i.details.includes("1) in command 2")){let e=Math.min(50,Math.ceil(2*E));l.oR.dismiss("swap-step"),ed(e),el(!0),k(!1);return}}throw Error(e)}l.oR.success("SUI to USDC swap completed successfully!",{id:"swap-step"}),console.log("Swap transaction executed with digest:",i.digest),ee(i.digest),es(i.createdCoinId),Z("deposit")}}catch(e){console.error("Error in swap step:",e),l.oR.error(e instanceof Error?"Swap failed: ".concat(e.message):"Swap failed. Please try again.",{id:"swap-step"})}finally{k(!1)}},ej=async()=>{if(!et||!S||!s||!t){l.oR.error("Missing required information for deposit",{id:"deposit-step"});return}ei(!0),l.oR.loading("Preparing deposit transaction...",{id:"deposit-step"});try{var e,o;let i;let n=new r.x({url:"https://fullnode.testnet.sui.io:443"});try{if(i=await n.getObject({id:et,options:{showContent:!0}}),!(null===(e=i.data)||void 0===e?void 0:e.content)||!("fields"in i.data.content))throw Error("Coin object not found or invalid");console.log("USDC coin found:",i)}catch(e){throw console.error("Error fetching USDC coin:",e),Error("USDC coin not found. The blockchain might still be processing the swap transaction. Please wait a moment and try again.")}let a=0;try{let e=await n.getDynamicFields({parentId:s});console.log("Looking for CircleConfig in dynamic fields...");let t=null;for(let s of e.data)if(s.name&&"object"==typeof s.name&&"type"in s.name&&s.name.type&&s.name.type.includes("vector<u8>")&&s.objectType&&s.objectType.includes("CircleConfig")){t=s.objectId,console.log("Found CircleConfig dynamic field: ".concat(t));break}if(t){let e=await n.getObject({id:t,options:{showContent:!0}});if((null===(o=e.data)||void 0===o?void 0:o.content)&&"fields"in e.data.content&&"value"in e.data.content.fields){let t=e.data.content.fields.value;if("object"==typeof t&&null!==t&&"fields"in t){let e=t.fields;c?(a=Number(e.contribution_amount_usd||0),console.log("Found contribution_amount_usd:",a)):(a=Number(e.security_deposit_usd||0),console.log("Found security_deposit_usd:",a))}}}}catch(e){console.error("Error fetching circle config details:",e)}let d=await fetch("/api/zkLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"depositStablecoin",account:S,circleId:s,walletId:t,coinObjectId:et,stablecoinType:ex,requiredDepositUsd:a})}),u=await d.json();if(!d.ok){if(console.error("Deposit response error:",u),en<3&&u.error&&(u.error.includes("object not found")||u.error.includes("Object does not exist"))){l.oR.error("Retrying deposit... Waiting for blockchain to process swap.",{id:"deposit-step",duration:5e3}),setTimeout(()=>{ei(!1),ea(e=>e+1)},3e3);return}if(u.error&&(u.error.includes("deposit amount does not match")||u.error.includes("EIncorrectDepositAmount")||u.error.match(/MoveAbort\(.+, 2\)/))){l.oR.error("The deposit amount doesn't match the required amount. This might be due to a currency conversion issue. Please try again.",{id:"deposit-step",duration:8e3}),ei(!1);return}if(u.error&&(u.error.includes("membership is not active")||u.error.includes("Member is not active")||u.error.includes("EMemberNotActive")||u.error.match(/MoveAbort\(.+, 14\)/))){l.oR.error("Your membership needs to be activated by the circle admin before you can deposit. Please contact the admin to activate your membership.",{id:"deposit-step",duration:8e3}),ei(!1);return}if(u.error&&(u.error.includes("already paid")||u.error.includes("EDepositAlreadyPaid")||u.error.match(/MoveAbort\(.+, 21\)/))){l.oR.success("You have already paid the security deposit for this circle!",{id:"deposit-step",duration:5e3}),Z("complete"),setTimeout(()=>{m&&m()},3e3),ei(!1);return}throw Error(u.error||"Failed to deposit USDC")}l.oR.success(c?"Contribution made successfully!":"Security deposit paid successfully!",{id:"deposit-step"}),console.log("Deposit transaction executed with digest:",u.digest),Z("complete"),setTimeout(()=>{U(""),I("0.0"),F(null),ee(null),es(null),ea(0),Z("swap"),m&&m()},3e3)}catch(e){console.error("Error in deposit step:",e),l.oR.error(e instanceof Error?"Deposit failed: ".concat(e.message):"Deposit failed. Please try again.",{id:"deposit-step"})}finally{ei(!1)}},ew=async()=>{"swap"===G?await ev():"deposit"===G&&await ej()},eN=async()=>{V(!0);try{let e=await u.n.forceRefreshPrice();if(e&&!isNaN(e)&&e>0){if(O(e),K(new Date),console.log("Manually refreshed SUI price:",e),C&&parseFloat(C)>0){let t=parseFloat(C)*e;I(t.toFixed(2)),z(e)}N>0&&ef(N,e,E),l.oR.success("Updated SUI price: $".concat(e.toFixed(2)))}else l.oR.error("Failed to refresh price")}catch(e){console.error("Error refreshing SUI price:",e),l.oR.error("Failed to refresh price")}finally{V(!1)}},eS=async()=>{let e=5;if(N>0){N<.1&&(e=10),c||(e=Math.max(e,12));try{let t=new Date().getHours();(t>=8&&t<=10||t>=15&&t<=17)&&(e=Math.max(e,15),eb(!0)),E<e&&(ed(e),e-E>=5&&el(!0))}catch(e){console.error("Error checking pool conditions:",e),ed(15)}}};return(0,i.useEffect)(()=>{N>0&&q&&eS()},[N,c]),(0,o.jsxs)("div",{className:"bg-[#121212] rounded-xl p-4 text-white",children:[(0,o.jsx)(w.A,{isOpen:er,onClose:()=>el(!1),onConfirm:()=>{let e=Math.min(50,Math.ceil(1.2*ec));if(M(e),console.log("Setting slippage to ".concat(e,"% (from recommendation of ").concat(ec,"%)")),J(!0),H&&C){let e=parseFloat(C),t=1.1*H;t>e&&(console.log("Increasing swap amount from ".concat(e," to ").concat(t)),U(t.toFixed(8)))}setTimeout(()=>{ev()},100)},title:"Price Movement Detected",confirmText:"Increase Slippage to ".concat(ec,"% & Retry"),cancelText:"Adjust Manually",confirmButtonVariant:"warning",message:(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("div",{className:"flex items-start",children:[(0,o.jsx)(g,{className:"text-amber-500 mr-2 mt-0.5 flex-shrink-0"}),(0,o.jsxs)("p",{children:["The SUI/USDC price is moving rapidly and your swap couldn't be completed with the current slippage tolerance of ",(0,o.jsxs)("span",{className:"font-medium",children:[E,"%"]}),"."]})]}),(0,o.jsxs)("div",{className:"bg-amber-50 p-3 rounded-md border border-amber-200 text-amber-800 text-sm",children:[(0,o.jsx)("p",{className:"font-medium mb-1",children:"Recommendation:"}),(0,o.jsxs)("p",{children:["Increase your slippage tolerance to ",(0,o.jsxs)("span",{className:"font-bold",children:[ec,"%"]})," to accommodate current market volatility."]})]}),(0,o.jsx)("div",{className:"text-sm text-gray-600",children:(0,o.jsx)("p",{children:"You can also close this dialog and adjust slippage manually in settings."})})]})}),(0,o.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,o.jsx)("div",{className:"flex space-x-6",children:(0,o.jsx)("button",{className:"text-white border-b-2 border-white pb-1 font-medium",children:"Swap"})}),(0,o.jsx)("div",{className:"flex items-center space-x-2",children:(0,o.jsxs)("div",{className:"".concat(eu?"bg-blue-900/50 border border-blue-500/50":"bg-[#232323]"," px-3 py-1 rounded-md flex items-center transition-colors"),children:[(0,o.jsxs)("span",{className:eu?"text-blue-400 font-medium":"",children:[E,"%",eu&&(0,o.jsx)("span",{className:"ml-1 text-xs px-1 py-0.5 bg-blue-800 rounded text-white",children:"custom"})]}),(0,o.jsx)("button",{onClick:()=>J(!P),className:"ml-2 ".concat(eu?"text-blue-400":""),title:"Adjust slippage tolerance",children:(0,o.jsx)(h.A,{size:16})})]})})]}),(0,o.jsxs)("div",{className:"flex justify-between items-center mb-3 bg-[#232323] px-3 py-2 rounded-lg text-sm",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("span",{className:"text-gray-400 mr-2",children:"SUI Price:"}),(0,o.jsx)("span",{className:"font-medium text-white",children:q?"$".concat(q.toFixed(2)):"Loading..."}),X&&(0,o.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:"updated ".concat(Math.floor((new Date().getTime()-X.getTime())/1e3/60),"m ago")})]}),(0,o.jsxs)("button",{onClick:eN,disabled:$,className:"flex items-center space-x-1 text-xs bg-[#333333] hover:bg-[#444444] px-2 py-1 rounded-md ".concat($?"opacity-50 cursor-not-allowed":""),children:[(0,o.jsx)(y.A,{size:12,className:$?"animate-spin":""}),(0,o.jsx)("span",{children:"Refresh"})]})]}),ep&&(0,o.jsxs)("div",{className:"bg-amber-900/30 border border-amber-500/50 rounded-md p-3 mb-4 flex items-start",children:[(0,o.jsx)(b.A,{size:18,className:"text-amber-500 mr-2 mt-0.5 flex-shrink-0"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-amber-400 font-medium text-sm mb-1",children:"High price volatility detected!"}),(0,o.jsxs)("p",{className:"text-amber-300/80 text-xs",children:["The SUI/USDC pool is experiencing significant price movement. Higher slippage values (",ec,"%) may be needed for successful swaps during these market conditions."]})]})]}),(0,o.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b border-gray-800 pb-3",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("div",{className:"flex items-center justify-center w-6 h-6 rounded-full mr-2 ".concat("swap"===G?"bg-blue-600 text-white":"deposit"===G||"complete"===G?"bg-green-500 text-white":"bg-gray-700 text-gray-300"),children:"swap"===G?"1":(0,o.jsx)(f,{size:14})}),(0,o.jsx)("span",{className:"swap"===G?"text-white font-medium":"text-gray-300",children:"Swap SUI to USDC"})]}),(0,o.jsx)("div",{className:"w-8 h-0.5 bg-gray-700"}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("div",{className:"flex items-center justify-center w-6 h-6 rounded-full mr-2 ".concat("deposit"===G?"bg-blue-600 text-white":"complete"===G?"bg-green-500 text-white":"bg-gray-700 text-gray-300"),children:"deposit"===G?"2":"complete"===G?(0,o.jsx)(f,{size:14}):"2"}),(0,o.jsx)("span",{className:"deposit"===G?"text-white font-medium":"text-gray-300",children:"Deposit to Circle"})]})]}),"complete"!==G?null:(0,o.jsx)("div",{className:"bg-green-900/30 border border-green-600/30 rounded-lg p-4 mb-4",children:(0,o.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,o.jsx)(f,{size:24,className:"text-green-400"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"font-medium text-green-400",children:"Transaction Complete!"}),(0,o.jsx)("p",{className:"text-sm text-green-300",children:c?"Your contribution was successfully processed.":"Your security deposit was successfully processed."})]})]})}),P&&(0,o.jsx)("div",{className:"bg-[#232323] p-3 rounded-lg mb-4",children:(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("label",{className:"text-sm text-gray-400",children:"Slippage Tolerance"}),(0,o.jsx)("div",{className:"flex mt-1 space-x-2 flex-wrap",children:[1,2,5,10,15].map(e=>(0,o.jsxs)("button",{onClick:()=>{if(M(e),N>0&&q){let t=ef(N,q,e);if(H&&(!C||""===C||parseFloat(C)>0&&.05>Math.abs((parseFloat(C)-H)/H))&&(console.log("Updating amount from slippage button: ".concat(e,"% → ").concat(t)),U(t.toString()),q)){let e=.97;c||(e=.95),t<.2&&(e-=.03),I((t*q*e).toFixed(6))}}},className:"px-3 py-1 rounded-md text-sm mb-1 ".concat(E===e?"bg-blue-600 text-white":"bg-[#333333] text-gray-300"),children:[e,"%"]},e))}),(0,o.jsx)("div",{className:"flex items-center mt-2",children:(0,o.jsx)("input",{type:"number",value:T,onChange:e=>{let t=e.target.value;R(t);let s=parseFloat(t);!isNaN(s)&&s>0&&s<=50&&M(s)},placeholder:"Custom (1-50%)",className:"bg-[#333333] text-white text-sm px-3 py-1 rounded-md w-full",min:"0.1",max:"50",step:"0.1"})})]})}),"swap"===G&&!c&&(0,o.jsx)("div",{className:"bg-[#1E1E2E] border border-blue-600/30 rounded-lg p-3 mb-3 text-sm",children:(0,o.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,o.jsx)(v.A,{size:16,className:"text-blue-400 flex-shrink-0 mt-0.5"}),(0,o.jsx)("span",{children:"Step 1: Swap your SUI to USDC for security deposit. After completing this step, you'll need to deposit the USDC."})]})}),"deposit"===G&&(0,o.jsx)("div",{className:"bg-[#1E1E2E] border border-blue-600/30 rounded-lg p-3 mb-3 text-sm",children:(0,o.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,o.jsx)(v.A,{size:16,className:"text-blue-400 flex-shrink-0 mt-0.5"}),(0,o.jsxs)("span",{children:["Step 2: Deposit the swapped USDC to the circle's custody wallet as ",c?"your contribution":"security deposit","."]})]})}),"swap"===G&&(0,o.jsxs)(o.Fragment,{children:[N>0&&(0,o.jsxs)("div",{className:"bg-[#1A1A1A] rounded-lg p-3 mb-3 text-sm",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsxs)("span",{className:"text-gray-400",children:["Required ",c?"contribution":"security deposit",":"]}),(0,o.jsxs)("span",{children:[N," SUI"]})]}),H&&(0,o.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,o.jsxs)("div",{className:"text-gray-400",children:["Suggested amount (with ",E,"% slippage + gas):"]}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsxs)("div",{className:"mr-2 text-white",children:[H.toFixed(8)," SUI"]}),(0,o.jsxs)("button",{onClick:()=>{if(H){U(H.toString());let e=document.getElementById("amount-input");if(e&&(e.value=H.toString()),q){let e=.97;c||(e=.95),H<.2&&(e-=.03);let t=H*q*e;I(t.toFixed(6)),F({amountIn:H,amountOut:1e6*t,price:q,priceImpact:.05,poolId:"suggested-amount"}),z(q*e),eg(H)}eS(),l.oR.success("Using suggested amount for optimal swap",{id:"suggested-amount"})}},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 flex items-center",children:["Use Suggested Amount (",H.toFixed(8)," SUI)"]})]})]})]}),(0,o.jsxs)("div",{className:"bg-[#1A1A1A] rounded-lg p-4 mb-2",children:[(0,o.jsx)("div",{className:"flex justify-between text-gray-400 mb-1",children:(0,o.jsx)("span",{children:"You Pay"})}),(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsx)("div",{className:"w-full px-4 py-3 bg-[#1B1B1B] rounded-lg flex items-center mt-1",children:(0,o.jsx)("input",{id:"amount-input",type:"number",value:C,onChange:e=>{let t=e.target.value;U(t);let s=parseFloat(t);if(isNaN(s)?Y(null):eg(s),q&&q>0&&t&&parseFloat(t)>0){let e=parseFloat(t),s=e*q;I(s.toFixed(2)),F({amountIn:e,amountOut:1e6*s,price:q,priceImpact:.1,poolId:"live-price"}),z(q)}else eh(t)},placeholder:"0.0",className:"bg-transparent text-2xl outline-none w-full",disabled:A})}),(0,o.jsxs)("div",{className:"flex flex-col items-end",children:[(0,o.jsx)("div",{className:"flex items-center bg-[#333333] py-1 px-3 rounded-lg mb-1",children:(0,o.jsx)("span",{className:"font-medium",children:"SUI"})}),(0,o.jsxs)("div",{className:"flex space-x-1",children:[(0,o.jsx)("button",{onClick:()=>{if(N>0){let e=(N/2).toString();if(U(e),q&&q>0){let e=N/2,t=e*q;I(t.toFixed(2)),F({amountIn:e,amountOut:1e6*t,price:q,priceImpact:.1,poolId:"live-price"}),z(q),eg(e)}else eh(e)}},className:"bg-[#2D2D2D] hover:bg-[#444444] text-xs px-2 py-1 rounded",children:"HALF"}),(0,o.jsx)("button",{onClick:()=>{if(N>0){if(U(N.toString()),q&&q>0){let e=N*q;I(e.toFixed(2)),F({amountIn:N,amountOut:1e6*e,price:q,priceImpact:.1,poolId:"live-price"}),z(q),eg(N)}else eh(N.toString())}},className:"bg-[#2D2D2D] hover:bg-[#444444] text-xs px-2 py-1 rounded",children:"MAX"})]})]})]}),(()=>{if(!L||"exact"===L)return null;let e=parseFloat(C),t=Math.abs(e-N).toFixed(6),s=Math.abs((e-N)/N*100).toFixed(1);return"underpaid"===L?(0,o.jsxs)("div",{className:"flex items-center space-x-1 text-amber-500 text-sm mt-1",children:[(0,o.jsx)(b.A,{size:14}),(0,o.jsxs)("span",{children:["Underpaying by ",t," SUI (",s,"%)"]})]}):"overpaid"===L?(0,o.jsxs)("div",{className:"flex items-center space-x-1 text-blue-500 text-sm mt-1",children:[(0,o.jsx)(b.A,{size:14}),(0,o.jsxs)("span",{children:["Overpaying by ",t," SUI (",s,"%)"]})]}):null})()]}),(0,o.jsx)("div",{className:"flex justify-center -my-1 relative z-10",children:(0,o.jsx)("div",{className:"bg-[#121212] p-2 rounded-full",children:(0,o.jsx)(j,{size:16,className:"text-gray-400"})})}),(0,o.jsxs)("div",{className:"bg-[#1A1A1A] rounded-lg p-4 mt-2",children:[(0,o.jsx)("div",{className:"flex justify-between text-gray-400 mb-1",children:(0,o.jsx)("span",{children:"You Receive"})}),(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsx)("input",{type:"text",value:D,readOnly:!0,className:"bg-transparent text-2xl outline-none w-full"}),(0,o.jsx)("div",{className:"flex items-center bg-[#333333] py-1 px-3 rounded-lg",children:(0,o.jsx)("span",{className:"font-medium",children:"USDC"})})]})]}),_&&(0,o.jsxs)("div",{className:"mt-4 bg-transparent px-1",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-400 mb-1",children:[(0,o.jsx)("span",{children:"Rate"}),(0,o.jsxs)("span",{children:["1 SUI = ",B?B.toFixed(4):"0.00"," USDC"]})]}),(0,o.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-400",children:[(0,o.jsx)("span",{children:"Price Impact"}),(()=>{if(!_)return"0.00%";let e=_.priceImpact,t="text-green-500";return e>5?t="text-red-500":e>1&&(t="text-amber-500"),(0,o.jsxs)("span",{className:t,children:[e.toFixed(2),"%"]})})()]}),(0,o.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-400 mt-1",children:[(0,o.jsx)("span",{children:"Network Fee"}),(0,o.jsxs)("span",{children:["~","0.000210"," SUI"]})]}),(0,o.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-400 mt-1",children:[(0,o.jsx)("span",{children:"Swap Provider"}),(0,o.jsx)("span",{className:"text-blue-400",children:"Cetus"})]}),_.priceImpact>5&&(0,o.jsx)("div",{className:"mt-2 bg-red-900/30 border border-red-600/30 rounded-md p-2 text-xs text-red-300",children:(0,o.jsxs)("div",{className:"flex items-start",children:[(0,o.jsx)(b.A,{size:12,className:"mr-1 mt-0.5 flex-shrink-0 text-red-400"}),(0,o.jsxs)("span",{children:["High price impact detected (",_.priceImpact.toFixed(2),"%). This trade may result in significant value loss due to low liquidity. Consider using a higher slippage tolerance or trading a smaller amount."]})]})})]})]}),"deposit"===G&&(0,o.jsxs)("div",{className:"bg-[#1A1A1A] rounded-lg p-4 mb-4",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-400 mb-2",children:[(0,o.jsx)("span",{children:"Swap Transaction:"}),(0,o.jsx)("a",{href:"https://explorer.sui.io/txblock/".concat(Q,"?network=testnet"),target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline truncate max-w-[180px]",children:Q?"".concat(Q.substring(0,8),"..."):"Loading..."})]}),(0,o.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-400 mb-2",children:[(0,o.jsx)("span",{children:"Swapped Amount:"}),(0,o.jsxs)("span",{className:"font-medium text-white",children:[D," USDC"]})]}),(0,o.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-400",children:[(0,o.jsx)("span",{children:"Destination:"}),(0,o.jsx)("span",{className:"font-medium text-white",children:"Circle Custody Wallet"})]})]}),(0,o.jsx)("button",{onClick:ew,disabled:x||A||eo||!C||0>=parseFloat(C)||"underpaid"===L||"complete"===G,className:"w-full mt-4 py-3 rounded-lg font-medium text-white transition-all ".concat(x||A||eo||!C||0>=parseFloat(C)||"underpaid"===L||"complete"===G?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:x?"Contributions Disabled":"complete"===G?"Transaction Complete":A||eo?"Processing...":"deposit"===G&&Q?"Complete Deposit":C&&parseFloat(C)>0&&"underpaid"===L?"Insufficient Amount":!C||0>=parseFloat(C)?"Enter Amount":c?"Swap & Contribute":"Swap & Pay Security Deposit"})]})},S=s(7836).env.NEXT_PUBLIC_NETWORK||"testnet",C={testnet:{SUI:"0x2::sui::SUI",USDC:"0x26b3bc67befc214058ca78ea9a2690298d731a2d4309485ec3d40198063c4abc::usdc::USDC"},mainnet:{SUI:"0x2::sui::SUI",USDC:"0x5d4b302506645c37ff133b98c4b50a5ae14841659738d6d733d59d0d217a93bf::coin::COIN"}},U=e=>C[S][e];var D=s(7836);function I(){return D.env.NEXT_PUBLIC_SUI_RPC_URL||"https://fullnode.testnet.sui.io:443"}let _=e=>{let{circleId:t,maxMembers:s,currentCycle:n,className:a=""}=e,[l,c]=(0,i.useState)({totalMembers:s,contributedMembers:new Set,currentCycle:n,memberList:[]}),[d,u]=(0,i.useState)(!0),p=async()=>{if(!t||n<=0){u(!1);return}u(!0),console.log("[Progress] Fetching contributions for Cycle ".concat(n," in circle ").concat(t));try{let o=new r.x({url:I()}),i=new Set,a=[];try{var e;let s=await o.getObject({id:t,options:{showContent:!0}});if((null===(e=s.data)||void 0===e?void 0:e.content)&&"fields"in s.data.content){let e=s.data.content.fields;if(e.rotation_order&&Array.isArray(e.rotation_order)){for(let t of e.rotation_order)"string"==typeof t&&"0x0"!==t&&a.push(t);console.log("[Progress] Found ".concat(a.length," members in rotation_order"))}}}catch(e){console.error("Error fetching circle members:",e)}try{let e=await o.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_payments::ContributionMade")},limit:200});for(let s of(console.log("[Progress] Fetched ".concat(e.data.length," ContributionMade events")),e.data))if(s.parsedJson&&"object"==typeof s.parsedJson){let e=s.parsedJson;if(e.circle_id===t&&e.member&&void 0!==e.cycle){let t="string"==typeof e.cycle?parseInt(e.cycle,10):e.cycle;isNaN(t)||t!==n||(console.log("[Progress] Found contribution from ContributionMade for user ".concat(e.member," in cycle ").concat(n)),i.add(e.member),a.includes(e.member)||a.push(e.member))}}}catch(e){console.error("Error fetching ContributionMade events:",e)}try{let e=await o.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_custody::CustodyDeposited")},limit:200});for(let s of(console.log("[Progress] Fetched ".concat(e.data.length," CustodyDeposited events")),e.data))if(s.parsedJson&&"object"==typeof s.parsedJson){let e=s.parsedJson,o="string"==typeof e.operation_type?parseInt(e.operation_type,10):e.operation_type;e.circle_id===t&&e.member&&0===o&&(console.log("[Progress] Found contribution from CustodyDeposited for user ".concat(e.member)),i.add(e.member),a.includes(e.member)||a.push(e.member))}}catch(e){console.error("Error fetching CustodyDeposited events:",e)}try{let e=await o.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_custody::CustodyTransaction")},limit:200});for(let s of(console.log("[Progress] Fetched ".concat(e.data.length," CustodyTransaction events")),e.data))if(s.parsedJson&&"object"==typeof s.parsedJson){let e=s.parsedJson,o="string"==typeof e.operation_type?parseInt(e.operation_type,10):e.operation_type;if(0===o&&console.log("[Progress] Found CustodyTransaction with operation_type=0:",{user:e.user,circleId:e.circle_id?e.circle_id:"not present"}),e.user&&0===o){if(e.circle_id&&e.circle_id!==t)continue;console.log("[Progress] Found contribution from CustodyTransaction for user ".concat(e.user)),i.add(e.user),a.includes(e.user)||a.push(e.user)}}}catch(e){console.error("Error fetching CustodyTransaction events:",e)}try{let e=await o.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_circles::StablecoinContributionMade")},limit:100});for(let s of(console.log("[Progress] Fetched ".concat(e.data.length," StablecoinContributionMade events")),e.data))if(s.parsedJson&&"object"==typeof s.parsedJson){let e=s.parsedJson;if(e.circle_id===t&&e.member){if(void 0!==e.cycle){let t="string"==typeof e.cycle?parseInt(e.cycle,10):e.cycle;isNaN(t)||t!==n||(console.log("[Progress] Found contribution from StablecoinContributionMade for user ".concat(e.member)),i.add(e.member),a.includes(e.member)||a.push(e.member))}else i.add(e.member),a.includes(e.member)||a.push(e.member)}}}catch(e){console.error("Error fetching StablecoinContributionMade events:",e)}for(;a.length<s;)a.push("Member-".concat(a.length+1));a.length>s&&a.splice(s),console.log("[Progress] Total unique contributors: ".concat(i.size,"/").concat(s)),console.log("[Progress] Contributors:",Array.from(i)),console.log("[Progress] All members:",a);let l=[...a.filter(e=>i.has(e)),...a.filter(e=>!i.has(e))];console.log("[Progress] Sorted members:",l),c({totalMembers:s,contributedMembers:i,currentCycle:n,memberList:l})}catch(e){console.error("Error fetching contribution events:",e)}finally{u(!1)}};(0,i.useEffect)(()=>{t&&s>0&&n>0?(console.log("[Progress] Required data available, fetching contribution events..."),p()):console.log("[Progress] Waiting for required data:",{circleId:t,maxMembers:s,currentCycle:n})},[t,s,n]);let b=l.contributedMembers.size,x=l.memberList.length,f=x>0?b/x*100:0,g=e=>!e.startsWith("0x")||e.length<=10?e:"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4));return(0,o.jsxs)("div",{className:"flex flex-col items-center ".concat(a),children:[(0,o.jsxs)("div",{className:"relative w-36 h-36",children:[(0,o.jsxs)("svg",{className:"w-full h-full",viewBox:"0 0 100 100",children:[(0,o.jsx)("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),(0,o.jsx)("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:100===f?"#10B981":"#3B82F6",strokeWidth:"8",strokeDasharray:"".concat(2.83*f," 283"),strokeDashoffset:"0",transform:"rotate(-90 50 50)",strokeLinecap:"round",className:"transition-all duration-500 ease-in-out"}),(0,o.jsx)("text",{x:"50",y:"50",textAnchor:"middle",dominantBaseline:"middle",className:"".concat(100===f?"text-green-500":f>60?"text-blue-500":f>30?"text-yellow-500":"text-gray-500"," font-bold text-xl fill-current"),children:d?"...":"".concat(Math.round(f),"%")}),(0,o.jsx)("text",{x:"50",y:"65",textAnchor:"middle",dominantBaseline:"middle",className:"text-gray-500 text-xs fill-current",children:"Complete"})]}),l.memberList.map((e,t)=>{let s=t/l.totalMembers*Math.PI*2-Math.PI/2,i=50+55*Math.cos(s),n=50+55*Math.sin(s),a=l.contributedMembers.has(e);return(0,o.jsxs)("div",{className:"group",children:[(0,o.jsx)("div",{className:"absolute w-3 h-3 rounded-full transform -translate-x-1/2 -translate-y-1/2 border border-white \n                  ".concat(a?"bg-green-500":"bg-gray-300"," \n                  hover:scale-125 transition-all duration-200"),style:{left:"".concat(i,"%"),top:"".concat(n,"%")}}),(0,o.jsx)("div",{className:"absolute hidden group-hover:block bg-gray-900 text-white text-xs rounded p-2 z-10",style:{left:"".concat(i,"%"),top:"".concat(n,"%"),transform:"translate(-50%, -100%)",marginTop:"-10px"},children:(0,o.jsxs)("p",{className:"whitespace-nowrap",children:[g(e),a?" ✓":" ✘"]})})]},t)})]}),(0,o.jsxs)("div",{className:"mt-4 text-center",children:[(0,o.jsx)("p",{className:"text-sm font-medium",children:d?"Loading...":"".concat(b," of ").concat(l.totalMembers," members")}),(0,o.jsxs)("p",{className:"text-xs text-gray-500",children:["Cycle ",l.currentCycle," Contributions"]})]}),(0,o.jsx)("div",{className:"mt-3 grid grid-cols-1 gap-2 text-xs w-full max-w-xs",children:l.memberList.map((e,t)=>{let s=l.contributedMembers.has(e);return(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("div",{className:"w-3 h-3 mr-2 rounded-full ".concat(s?"bg-green-500":"bg-gray-300")}),(0,o.jsx)("span",{className:"font-mono",children:g(e)})]}),(0,o.jsx)("span",{className:s?"text-green-600 font-medium":"text-gray-500",children:s?"Contributed":"Pending"})]},t)})})]})};function F(){var e,t,s;let p=(0,n.useRouter)(),{id:b}=p.query,{isAuthenticated:x,userAddress:f,account:g}=(0,a.A)(),[h,y]=(0,i.useState)(!0),[v,j]=(0,i.useState)(null),[w,S]=(0,i.useState)(!1),[C,D]=(0,i.useState)(1.25),[F,A]=(0,i.useState)(null),[k,E]=(0,i.useState)(!1),[M,T]=(0,i.useState)(!1),[R,P]=(0,i.useState)(!1),[J,q]=(0,i.useState)(null),[O,B]=(0,i.useState)(null),[z,L]=(0,i.useState)(null),[Y,H]=(0,i.useState)(!1),[W,$]=(0,i.useState)(!0),[V,X]=(0,i.useState)(null),[K,G]=(0,i.useState)(!1),[Z,Q]=(0,i.useState)(!1),ee=U("USDC"),[et,es]=(0,i.useState)(null),[eo,ei]=(0,i.useState)(!1),[en,ea]=(0,i.useState)(null),[er,el]=(0,i.useState)(null),[ec,ed]=(0,i.useState)(1),[eu,em]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!x){p.push("/");return}},[x,p]),(0,i.useEffect)(()=>{(async()=>{try{let e=await u.n.getSUIPrice();e&&!isNaN(e)&&e>0&&(D(e),console.log("Fetched SUI price:",e))}catch(e){console.error("Error fetching SUI price:",e)}})()},[]),(0,i.useEffect)(()=>{b&&f&&eb()},[b,f]),(0,i.useEffect)(()=>{v&&f&&ex()},[v,f]),(0,i.useEffect)(()=>{v&&null!==k&&console.log("Security deposit button conditions:",{userDepositPaid:k,hasCircle:!!v,securityDepositAmount:v.securityDeposit,shouldShowButton:!k&&!!v&&v.securityDeposit>0})},[v,k]),(0,i.useEffect)(()=>{v&&console.log("Security deposit values:",{rawValue:v.securityDeposit,usdValue:v.securityDepositUsd,formattedSUI:"".concat(v.securityDeposit," SUI"),formattedUSD:"$".concat(v.securityDepositUsd)})},[v]),(0,i.useEffect)(()=>{v&&v.walletId&&eD()},[null==v?void 0:v.id,null==v?void 0:v.walletId]),(0,i.useEffect)(()=>{(null==v?void 0:v.walletId)&&ep()},[null==v?void 0:v.walletId]),(0,i.useEffect)(()=>{v&&(ex(),ep(),eD())},[v]);let ep=async()=>{if(null==v?void 0:v.walletId){ei(!0);try{var e,t,s;let o=new r.x({url:"https://fullnode.testnet.sui.io:443"}),i=0,n=0,a=await o.getObject({id:v.walletId,options:{showContent:!0}});if((null===(e=a.data)||void 0===e?void 0:e.content)&&"fields"in a.data.content){let e=a.data.content.fields;e.balance&&"object"==typeof e.balance&&"fields"in e.balance?i=Number((null===(t=e.balance.fields)||void 0===t?void 0:t.value)||0)/1e9:e.balance&&(i=Number(e.balance)/1e9),console.log("[SUI Balance Fetch] Main Balance (Contributions): ".concat(i))}else console.warn("[SUI Balance] Could not fetch main CustodyWallet object content.");let l=await o.getDynamicFields({parentId:v.walletId});for(let e of(console.log("[SUI Balance] Dynamic Fields:",l.data),l.data))if(e.objectType&&e.objectType.includes("::coin::Coin<0x2::sui::SUI>")){console.log("[SUI Balance] Found SUI Coin dynamic field: ".concat(e.objectId));let t=await o.getObject({id:e.objectId,options:{showContent:!0}});if((null===(s=t.data)||void 0===s?void 0:s.content)&&"fields"in t.data.content){let e=t.data.content.fields;if(e.balance){n=Number(e.balance)/1e9,console.log("[SUI Balance Fetch] Dynamic Field Balance (Security Deposits): ".concat(n));break}}}let c=await o.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_custody::CustodyDeposited")},limit:100}),d=0;for(let e of c.data)if(e.parsedJson&&"object"==typeof e.parsedJson&&"circle_id"in e.parsedJson&&"operation_type"in e.parsedJson&&"amount"in e.parsedJson&&e.parsedJson.circle_id===v.id){let t=e.parsedJson;if("stablecoin"===t.coin_type||t.coin_type&&"sui"!==t.coin_type)continue;let s="string"==typeof t.operation_type?parseInt(t.operation_type):t.operation_type;3===s&&(d+=Number(t.amount)/1e9)}console.log("[SUI Balance Fetch] Total SUI Security Deposits from Events (for verification): ".concat(d));let u=n,p=i,b=p+u;console.log("[SUI Balance Fetch] Setting SUI state:",{totalSuiBalance:b,securityDepositSui:u,contributionSui:p}),es(b),ea(u),el(p),console.log("[SUI Balance] Final breakdown:",{total:b,securityDeposit:u,contribution:p})}catch(e){console.error("Error fetching custody wallet SUI balance:",e),es(null),ea(null),el(null)}finally{ei(!1)}}},eb=async()=>{if(b){console.log("Contribute - Fetching circle details for:",b),y(!0);try{var e,t,s,o,i,n,a,c,d;let l,u;let p=new r.x({url:"https://fullnode.testnet.sui.io:443"}),x=await p.getObject({id:b,options:{showContent:!0,showType:!0}});if(!(null===(e=x.data)||void 0===e?void 0:e.content)||!("fields"in x.data.content))throw Error("Invalid circle object data received");let f=x.data.content.fields;console.log("Contribute - Raw Circle Object Fields:",f);let g=!1;"is_active"in f&&(g=!!f.is_active,console.log("Contribute - Found is_active field in circle object:",g));let h=1;"current_cycle"in f&&"string"==typeof f.current_cycle&&(h=parseInt(f.current_cycle,10),console.log("Contribute - Found current_cycle field:",h)),ed(h);let y=10;if(!g)try{(await p.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_circles::CircleActivated")},limit:50})).data.some(e=>{let t=e.parsedJson;return(null==t?void 0:t.circle_id)===b})&&(g=!0,console.log("Contribute - Circle is active based on CircleActivated event"))}catch(e){console.error("Contribute - Error checking activation events:",e)}"0xa37e274f29ebc5a37b3f5c8acd3db61aac022739dc52973a0312ae3b19f18128"===b&&(console.log("Contribute - Special case: Known active circle detected. Forcing isActive to true."),g=!0);let v=(await p.getDynamicFields({parentId:b})).data;console.log("Contribute - Dynamic Fields:",v);let w="";try{let e=(await p.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_circles::CircleCreated")},limit:50})).data.find(e=>{var t;return(null===(t=e.parsedJson)||void 0===t?void 0:t.circle_id)===b});if(console.log("Contribute - Found creation event:",!!e),(null==e?void 0:e.parsedJson)&&(l={contribution_amount:(u=e.parsedJson).contribution_amount,contribution_amount_usd:u.contribution_amount_usd,security_deposit_usd:u.security_deposit_usd},u.max_members&&(y=parseInt(u.max_members,10),console.log("Contribute - Found max_members from creation event:",y))),null==e?void 0:null===(t=e.id)||void 0===t?void 0:t.txDigest){let t=await p.getTransactionBlock({digest:e.id.txDigest,options:{showInput:!0}});if(console.log("Contribute - Transaction data fetched:",!!t),(null==t?void 0:null===(i=t.transaction)||void 0===i?void 0:null===(o=i.data)||void 0===o?void 0:null===(s=o.transaction)||void 0===s?void 0:s.kind)==="ProgrammableTransaction"){let e=t.transaction.data.transaction.inputs||[];console.log("Contribute - Transaction inputs:",e),l||(l={}),e.length>1&&(null===(n=e[1])||void 0===n?void 0:n.type)==="pure"&&(l.contribution_amount=e[1].value),e.length>2&&(null===(a=e[2])||void 0===a?void 0:a.type)==="pure"&&(l.contribution_amount_usd=e[2].value),e.length>4&&(null===(c=e[4])||void 0===c?void 0:c.type)==="pure"&&(l.security_deposit_usd=e[4].value)}}let r=(await p.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_custody::CustodyWalletCreated")},limit:100})).data.find(e=>e.parsedJson&&"object"==typeof e.parsedJson&&"circle_id"in e.parsedJson&&"wallet_id"in e.parsedJson&&e.parsedJson.circle_id===b);(null==r?void 0:r.parsedJson)&&(w=r.parsedJson.wallet_id,console.log("Contribute - Found wallet ID from events:",w))}catch(e){console.error("Contribute - Error fetching event/transaction data:",e)}let N={contributionAmount:0,contributionAmountUsd:0,securityDeposit:0,securityDepositUsd:0,autoSwapEnabled:!1};for(let e of(l&&(l.contribution_amount&&(N.contributionAmount=Number(l.contribution_amount)/1e9),l.contribution_amount_usd&&(N.contributionAmountUsd=Number(l.contribution_amount_usd)/100),l.security_deposit_usd&&(N.securityDepositUsd=Number(l.security_deposit_usd)/100)),console.log("Contribute - Config after Tx/Event:",N),v))if(e&&e.objectType&&"string"==typeof e.objectType&&e.objectType.includes("::CircleConfig")&&(console.log("Contribute - Found CircleConfig dynamic field by objectType:",e),e.objectId)){console.log("Contribute - Fetching CircleConfig dynamic field object:",e.objectId);try{let t=await p.getObject({id:e.objectId,options:{showContent:!0}});if(console.log("Contribute - Config object content:",t),(null===(d=t.data)||void 0===d?void 0:d.content)&&"fields"in t.data.content){let s=t.data.content.fields;if("object"==typeof s&&null!==s&&"value"in s){let t=s.value;if("object"==typeof t&&null!==t&&"fields"in t){let s=t.fields;if(console.log("Contribute - Accessed nested configFields:",s),s.contribution_amount&&(N.contributionAmount=Number(s.contribution_amount)/1e9),s.contribution_amount_usd&&(N.contributionAmountUsd=Number(s.contribution_amount_usd)/100),s.security_deposit&&(N.securityDeposit=Number(s.security_deposit)/1e9),s.security_deposit_usd&&(N.securityDepositUsd=Number(s.security_deposit_usd)/100),void 0!==s.auto_swap_enabled){let t=!!s.auto_swap_enabled;console.log("Contribute - Found auto_swap_enabled (".concat(t,") in dynamic field ").concat(e.objectId)),N.autoSwapEnabled=t}s.max_members&&(y=Number(s.max_members),console.log("Contribute - Found max_members (".concat(y,") in config field")))}else console.warn("Contribute - Could not find nested fields in outerFields.value")}else console.warn("Contribute - Could not find 'value' property in outerFields")}else console.warn("Contribute - Could not find fields in configData.data.content")}catch(t){console.error("Contribute - Error fetching config object ".concat(e.objectId,":"),t)}break}if(console.log("Contribute - Config after Dynamic Fields:",N),0===N.contributionAmount&&f.contribution_amount&&(N.contributionAmount=Number(f.contribution_amount)/1e9),0===N.contributionAmountUsd){if(f.contribution_amount_usd)N.contributionAmountUsd=Number(f.contribution_amount_usd)/100;else if(f.usd_amounts&&"object"==typeof f.usd_amounts&&null!==f.usd_amounts){let e=f.usd_amounts,t=e.fields||e;(null==t?void 0:t.contribution_amount)&&(N.contributionAmountUsd=Number(t.contribution_amount)/100)}}if(0===N.securityDeposit&&f.security_deposit&&(N.securityDeposit=Number(f.security_deposit)/1e9),0===N.securityDepositUsd){if(f.security_deposit_usd)N.securityDepositUsd=Number(f.security_deposit_usd)/100;else if(f.usd_amounts&&"object"==typeof f.usd_amounts&&null!==f.usd_amounts){let e=f.usd_amounts,t=e.fields||e;(null==t?void 0:t.security_deposit)&&(N.securityDepositUsd=Number(t.security_deposit)/100)}}console.log("Contribute - Config after Direct Fields Fallback:",N),0===N.contributionAmount&&N.contributionAmountUsd>0&&C>0&&(N.contributionAmount=N.contributionAmountUsd/C,console.log("Contribute - Calculated contribution SUI from USD: ".concat(N.contributionAmount))),0===N.securityDeposit&&N.securityDepositUsd>0&&C>0&&(N.securityDeposit=N.securityDepositUsd/C,console.log("Contribute - Calculated security deposit SUI from USD: ".concat(N.securityDeposit))),w||"string"!=typeof f.wallet_id||(w=f.wallet_id,console.log("Contribute - Using wallet ID from direct field:",w)),j({id:b,name:"string"==typeof f.name?f.name:"",admin:"string"==typeof f.admin?f.admin:"",contributionAmount:N.contributionAmount,contributionAmountUsd:N.contributionAmountUsd,securityDeposit:N.securityDeposit,securityDepositUsd:N.securityDepositUsd,walletId:w,autoSwapEnabled:N.autoSwapEnabled,isActive:g,maxMembers:y}),console.log("Contribute - Final circle state:",{id:b,name:"string"==typeof f.name?f.name:"",admin:"string"==typeof f.admin?f.admin:"",contributionAmount:N.contributionAmount,contributionAmountUsd:N.contributionAmountUsd,securityDeposit:N.securityDeposit,securityDepositUsd:N.securityDepositUsd,walletId:w,autoSwapEnabled:N.autoSwapEnabled,isActive:g,maxMembers:y})}catch(e){console.error("Contribute - Error fetching circle details:",e),l.oR.error("Could not load circle information")}finally{y(!1)}}},ex=async()=>{if(!f||!v||!v.id){console.log("Skipping fetchUserWalletInfo: Missing userAddress or circle info.");return}T(!0);let e=!1;try{let c=new r.x({url:I()}),d=(await c.getCoins({owner:f,coinType:"0x2::sui::SUI"})).data.reduce((e,t)=>e+Number(t.balance),0)/1e9;A(d);try{let e=(await c.getCoins({owner:f,coinType:ee})).data.reduce((e,t)=>e+Number(t.balance),0)/1e6;X(e);let t=!1,s=e>=v.securityDepositUsd,o=e>=v.contributionAmountUsd,i=!!v.autoSwapEnabled,n=!!v.isActive;console.log("[Direct Deposit Check]",{userDepositPaid:k,hasEnoughForSecurity:s,hasEnoughForContribution:o,autoSwapOn:i,circleActive:n,securityDepositUsd:v.securityDepositUsd,contributionAmountUsd:v.contributionAmountUsd,totalUsdcBalance:e}),!k&&s&&i?(t=!0,console.log("Showing direct deposit for SECURITY DEPOSIT (Circle active status ignored)")):k&&o&&i&&n&&(t=!0,console.log("Showing direct deposit for CONTRIBUTION (Circle must be active)")),G(t)}catch(e){console.error("Error fetching USDC balance:",e),X(null),G(!1)}console.log("Checking deposit status for user ".concat(f," in circle ").concat(v.id,"..."));try{var t,s,o,i,n,a,l;let r=await c.getObject({id:v.id,options:{showContent:!0}});if((null===(t=r.data)||void 0===t?void 0:t.content)&&"fields"in r.data.content){let t=r.data.content.fields;if(null===(i=t.members)||void 0===i?void 0:null===(o=i.fields)||void 0===o?void 0:null===(s=o.id)||void 0===s?void 0:s.id){let s=t.members.fields.id.id;console.log("Attempting to fetch Member object using key ".concat(f," from table ").concat(s));let o=await c.getDynamicFieldObject({parentId:s,name:{type:"address",value:f}});if((null===(n=o.data)||void 0===n?void 0:n.content)&&"fields"in o.data.content){let t=o.data.content.fields;(null===(l=t.value)||void 0===l?void 0:null===(a=l.fields)||void 0===a?void 0:a.deposit_paid)!==void 0?(e=!!t.value.fields.deposit_paid,console.log("Deposit status found directly in Member struct: ".concat(e))):console.log("Member struct found, but deposit_paid field missing or undefined.")}else console.log("Could not find dynamic field object for this user in the members table.")}else console.log("Members table ID not found in Circle object.")}}catch(e){console.warn("Could not fetch Member object directly, falling back to event checks:",e)}if(!e){console.log("Checking MemberActivated events...");try{(e=(await c.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_members::MemberActivated")},limit:50})).data.some(e=>{let t=e.parsedJson;return(null==t?void 0:t.circle_id)===v.id&&(null==t?void 0:t.member)===f}))?console.log("Deposit status confirmed via MemberActivated event."):console.log("No MemberActivated event found for this user/circle.")}catch(e){console.error("Error fetching MemberActivated events:",e)}}!e&&(console.log("Checking deposit-related events as final fallback..."),(await c.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_custody::CustodyDeposited")},limit:50})).data.some(e=>{let t=e.parsedJson;return(null==t?void 0:t.circle_id)===v.id&&(null==t?void 0:t.member)===f&&((null==t?void 0:t.operation_type)===3||(null==t?void 0:t.operation_type)==="3")})&&(e=!0,console.log("Deposit status confirmed via CustodyDeposited event (type 3)."))),E(e),console.log("Final user deposit status:",e?"Paid":"Not Paid")}catch(e){console.error("Error fetching user wallet info:",e)}finally{T(!1)}},ef=async()=>{if(v&&v.id&&f){console.log("[Contribution Check] Starting check for user ".concat(f," in circle ").concat(v.id," for cycle ").concat(ec));try{let e=new r.x({url:I()}),t=!1,s=await e.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_payments::ContributionMade")},limit:100});for(let e of(console.log("[Contribution Check] Found ".concat(s.data.length," ContributionMade events")),s.data))if(e.parsedJson&&"object"==typeof e.parsedJson){let s=e.parsedJson,o="string"==typeof s.cycle?parseInt(s.cycle,10):s.cycle;if(s.circle_id===v.id&&s.member===f&&o===ec){t=!0,console.log("[Contribution Check] MATCH: Found ContributionMade for user ".concat(f," in cycle ").concat(ec));break}}if(!t){let s=await e.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_circles::StablecoinContributionMade")},limit:100});for(let e of(console.log("[Contribution Check] Found ".concat(s.data.length," StablecoinContributionMade events")),s.data))if(e.parsedJson&&"object"==typeof e.parsedJson){let s=e.parsedJson,o="string"==typeof s.cycle?parseInt(s.cycle,10):s.cycle;if(s.circle_id===v.id&&s.member===f){if(void 0!==o){if(o===ec){t=!0,console.log("[Contribution Check] MATCH: Found StablecoinContributionMade for user ".concat(f," in cycle ").concat(ec));break}}else{t=!0,console.log("[Contribution Check] MATCH: Found StablecoinContributionMade for user ".concat(f," (cycle not specified)"));break}}}}if(!t){let s=await e.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_custody::CustodyDeposited")},limit:100});for(let e of(console.log("[Contribution Check] Found ".concat(s.data.length," CustodyDeposited events")),s.data))if(e.parsedJson&&"object"==typeof e.parsedJson){let s=e.parsedJson,o="string"==typeof s.operation_type?parseInt(s.operation_type,10):s.operation_type;if(s.circle_id===v.id&&s.member===f&&0===o){t=!0,console.log("[Contribution Check] MATCH: Found CustodyDeposited with operation_type=0 for user ".concat(f));break}}}if(!t){let s=await e.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_custody::CustodyTransaction")},limit:100});for(let e of(console.log("[Contribution Check] Found ".concat(s.data.length," CustodyTransaction events")),s.data))if(e.parsedJson&&"object"==typeof e.parsedJson){let s=e.parsedJson,o="string"==typeof s.operation_type?parseInt(s.operation_type,10):s.operation_type;if(s.user===f&&0===o&&(void 0===s.circle_id||s.circle_id===v.id)){t=!0,console.log("[Contribution Check] MATCH: Found CustodyTransaction with operation_type=0 for user ".concat(f));break}}}return console.log("[Contribution Check] Final result for user ".concat(f,": ").concat(t?"HAS contributed":"has NOT contributed")),em(t),t}catch(e){return console.error("Error checking user contributions:",e),!1}}};(0,i.useEffect)(()=>{v&&f&&ef()},[v,f,ec]);let eg=async()=>{if(v&&f){if(await ef()){l.oR.error("You have already contributed for this cycle.");return}S(!0);try{if(!k){l.oR.error("Security deposit required before contributing"),S(!1);return}if(!g){l.oR.error("User account not available. Please log in again."),S(!1);return}let e=null!==z&&z>=v.contributionAmountUsd;console.log("Contribution source decision:",{totalBalance:J,securityDeposits:O,contributionFunds:z,requiredAmount:v.contributionAmountUsd,hasEnoughUSDC:e,willUseUSDC:e}),e?l.oR.loading("Processing contribution from custody wallet USDC...",{id:"contribute-tx"}):l.oR.loading("Processing contribution from SUI...",{id:"contribute-tx"});let t=await fetch("/api/zkLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"contributeFromCustody",account:g,circleId:v.id,walletId:v.walletId,useUSDC:e})}),s=await t.json();if(!t.ok){console.error("Contribution failed:",s),l.oR.error(s.error||"Failed to process contribution",{id:"contribute-tx"});return}e?l.oR.success("Contribution successful! Used USDC from custody wallet.",{id:"contribute-tx"}):l.oR.success("Contribution successful!",{id:"contribute-tx"}),console.log("Contribution transaction digest:",s.digest),ex(),eb(),eD()}catch(e){console.error("Error contributing:",e),l.oR.error("Failed to process contribution")}finally{S(!1)}}},eh=()=>v&&v.securityDepositUsd&&"number"==typeof C&&!(C<=0)?v.securityDepositUsd/C:(null==v?void 0:v.securityDeposit)||0,ey=e=>!e||e<=0?0:e+.005*e+.015*e+21e-5,ev=()=>ey(eh()),ej=()=>ey(eC()),ew=e=>{let t=.005*e,s=.015*e;return{baseAmount:e,slippageBuffer:t,rateBuffer:s,gasFee:21e-5,total:e+t+s+21e-5}},eN=async()=>{if(!v||!f||!v.walletId){l.oR.error("Circle information incomplete. Cannot process deposit.");return}let e=ev();if(null!==F&&F<e){l.oR.error("Insufficient wallet balance to pay security deposit.");return}P(!0);try{if(console.log("Preparing to pay security deposit:",{baseAmount:eh(),requiredAmount:e,breakdown:ew(eh())}),!g){l.oR.error("User account not available. Please log in again."),P(!1);return}l.oR.loading("Processing security deposit payment...",{id:"pay-security-deposit"});let t=eh(),s=await fetch("/api/zkLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"paySecurityDeposit",account:g,circleId:v.id,walletId:v.walletId,depositAmount:Math.floor(1e9*t)})}),o=await s.json();s.ok?(l.oR.success("Security deposit paid successfully!",{id:"pay-security-deposit"}),ex(),eb()):(console.error("Security deposit payment failed:",o),l.oR.error(o.error||"Failed to process security deposit payment",{id:"pay-security-deposit"}))}catch(e){console.error("Error paying security deposit:",e),l.oR.error("Failed to process security deposit payment")}finally{P(!1)}},eS=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),eC=()=>{let e="number"!=typeof(null==v?void 0:v.contributionAmount)||isNaN(v.contributionAmount)?0:v.contributionAmount,t=e>0&&e<1e3;return!t&&(null==v?void 0:v.contributionAmountUsd)&&"number"==typeof v.contributionAmountUsd&&!isNaN(v.contributionAmountUsd)&&"number"==typeof C&&C>0?v.contributionAmountUsd/C:t?e:0},eU=e=>{let{usd:t,sui:s,className:i=""}=e,n=null===C,a="error"===u.n.getFetchStatus();console.log("CurrencyDisplay inputs:",{usd:t,sui:s,suiPrice:C,isPriceUnavailable:n}),(void 0===t||isNaN(t))&&(void 0===s||isNaN(s))&&(console.log("CurrencyDisplay: both usd and sui values are invalid, defaulting to 0"),t=0,s=0);let r=null,l=null;void 0===t||isNaN(t)?void 0===s||isNaN(s)?console.log("CurrencyDisplay: using default values:",{sui:r=0,usd:l=0}):console.log("CurrencyDisplay: using SUI value to calculate SUI:",{sui:r=s,usd:l=null!==C?s*C:null,suiPrice:C}):console.log("CurrencyDisplay: using USD value to calculate SUI:",{usd:l=t,sui:r=null!==C&&C>0?t/C:null,suiPrice:C});let c=null!==r?r>=1e3?r.toLocaleString(void 0,{maximumFractionDigits:0}):r>=100?r.toFixed(1):r.toFixed(2):"—";return i.includes("inline")?(0,o.jsxs)("span",{className:i,children:[null!==l?eS(l):"$—.—"," (",c," SUI)",a&&(0,o.jsx)("span",{title:"Using cached price",className:"text-xs text-amber-500 ml-1",children:"⚠️"})]}):(0,o.jsx)(d.Kq,{children:(0,o.jsxs)(d.bL,{children:[(0,o.jsx)(d.l9,{asChild:!0,children:(0,o.jsxs)("div",{className:"flex flex-col ".concat(i," cursor-help"),children:[(0,o.jsx)("span",{className:"font-medium",children:null!==l?eS(l):"$—.—"}),(0,o.jsxs)("span",{className:"text-sm text-gray-500",children:[c," SUI"]}),a&&(0,o.jsx)("span",{title:"Using cached price",className:"text-xs text-amber-500",children:"⚠️ Cached price"})]})}),(0,o.jsx)(d.ZL,{children:(0,o.jsxs)(d.UC,{className:"bg-gray-900 text-white px-3 py-2 rounded text-sm",sideOffset:5,children:[(0,o.jsxs)("div",{className:"space-y-1",children:[(0,o.jsx)("p",{children:"SUI Conversion Rate:"}),null!==C?(0,o.jsxs)("p",{children:["1 SUI = ",eS(C)]}):(0,o.jsx)("p",{className:"text-amber-400",children:"SUI price unavailable"}),(0,o.jsx)("p",{className:"text-xs text-gray-400",children:a?"Using cached price - service temporarily unavailable":"Updated price data from CoinGecko"})]}),(0,o.jsx)(d.i3,{className:"fill-gray-900"})]})})]})})},eD=async()=>{let e;if(!v||!v.walletId)return;H(!0);let t=!W;t&&(e=l.oR.loading("Refreshing USDC balance...")),$(!1);try{let s=new r.x({url:"https://fullnode.testnet.sui.io:443"}),o=null,i=0,n=0,a=await s.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_custody::CoinDeposited")},limit:20});for(let e of(console.log("[USDC Balance] Found ".concat(a.data.length," CoinDeposited events")),a.data))if(e.parsedJson&&"object"==typeof e.parsedJson&&"wallet_id"in e.parsedJson&&"coin_type"in e.parsedJson&&"new_balance"in e.parsedJson){let t=e.parsedJson;if(console.log("[USDC Balance] Processing event with coin_type: ".concat(t.coin_type,", wallet_id: ").concat(t.wallet_id)),t.wallet_id===v.walletId&&"stablecoin"===t.coin_type){let e=Number(t.new_balance)/1e6;(null===o||e>o)&&(o=e,console.log("[USDC Balance Fetch] Found stablecoin balance from CoinDeposited event:",e))}}if(null===o){for(let e of(await s.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_circles::StablecoinDeposited")},limit:10})).data)if(e.parsedJson&&"object"==typeof e.parsedJson&&"wallet_id"in e.parsedJson&&"new_balance"in e.parsedJson){let t=e.parsedJson;if(t.wallet_id===v.walletId){let e=Number(t.new_balance)/1e6;o=e,console.log("Found stablecoin balance from StablecoinDeposited event:",e,"USDC");break}}}for(let e of(await s.queryEvents({query:{MoveEventType:"".concat(m.j,"::njangi_custody::CustodyDeposited")},limit:50})).data)if(e.parsedJson&&"object"==typeof e.parsedJson&&"circle_id"in e.parsedJson&&"operation_type"in e.parsedJson&&"amount"in e.parsedJson&&e.parsedJson.circle_id===v.id){let t=e.parsedJson;if("sui"===t.coin_type){console.log("Skipping SUI event in stablecoin balance calculation");continue}let s="string"==typeof t.operation_type?parseInt(t.operation_type):t.operation_type;if(3===s){let e=Number(t.amount)/1e6;i+=e,console.log("Found security deposit USDC: ".concat(e))}}null!==o&&(i=Math.min(i,o),n=Math.max(0,o-i)),null!==o?(q(o),B(i),L(n),console.log("[USDC Balance Fetch] Setting USDC state:",{newBalance:o,newSecurityDepositBalance:i,newContributionBalance:n}),console.log("Custody stablecoin balances breakdown:",{total:o,securityDeposits:i,contributionFunds:n})):(q(0),B(0),L(0),console.log("No stablecoin balance found, setting to zero")),t&&e&&(null!==o?J!==o?(l.oR.success("Balance updated: $".concat(o.toFixed(2)," USDC"),{id:e}),i>0&&l.oR.success("Security deposit detected: $".concat(i.toFixed(2)," USDC"),{id:"security-deposit-toast",duration:5e3})):l.oR.success("Balance refreshed",{id:e}):l.oR.success("Balance check completed",{id:e}))}catch(s){console.error("Error fetching custody wallet stablecoin balance:",s),t&&e&&l.oR.error("Failed to fetch balance",{id:e})}finally{H(!1)}},eI=async()=>{if(v&&f&&V){if(await ef()){l.oR.error("You have already contributed for this cycle.");return}Q(!0);try{let e=l.oR.loading("Processing direct USDC deposit..."),t=!k,s=t?v.securityDepositUsd:v.contributionAmountUsd;if(V<s){l.oR.error("Insufficient USDC balance. Need ".concat(s.toFixed(2)," USDC but you have ").concat(V.toFixed(2)," USDC."),{id:e}),Q(!1);return}if(!g){l.oR.error("User account not available. Please log in again.",{id:e}),Q(!1);return}console.log("Processing direct USDC deposit with parameters:",{circleId:v.id,walletId:v.walletId,usdcAmount:s,isSecurityDeposit:t});let o=await fetch("/api/zkLogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"depositUsdcDirect",account:g,circleId:v.id,walletId:v.walletId,usdcAmount:Math.floor(1e6*s),isSecurityDeposit:t})}),i=await o.json();if(!o.ok){console.error("Direct USDC deposit failed:",i),l.oR.error(i.error||"Failed to process USDC deposit",{id:e});return}t?l.oR.success("Security deposit paid successfully with your USDC!",{id:e}):l.oR.success("Contribution made successfully with your USDC!",{id:e}),console.log("Direct USDC deposit transaction digest:",i.digest),ex(),eb(),eD()}catch(e){console.error("Error in direct USDC deposit:",e),l.oR.error("Failed to process USDC deposit")}finally{Q(!1)}}};return x&&g?(0,o.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,o.jsx)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,o.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[(0,o.jsx)("div",{className:"mb-6",children:(0,o.jsxs)("button",{onClick:()=>p.push("/dashboard"),className:"inline-flex items-center gap-1.5 px-4 py-2 rounded-full bg-white border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-all shadow-sm text-sm text-gray-700 font-medium",children:[(0,o.jsx)(c.A,{className:"w-4 h-4"}),"Back to Dashboard"]})}),(0,o.jsx)("div",{className:"bg-white shadow-md rounded-xl overflow-hidden border border-gray-100",children:(0,o.jsxs)("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[(0,o.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:!h&&v?"Contribute to ".concat(v.name):"Contribute to Circle"}),h?(0,o.jsx)("div",{className:"py-8 flex justify-center",children:(0,o.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}):v?(0,o.jsxs)("div",{className:"py-4 space-y-8",children:[(0,o.jsxs)("div",{className:"px-2",children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4 border-l-4 border-green-500 pl-3",children:"Your Wallet"}),(0,o.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg shadow-sm border border-blue-100",children:(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Available Balance:"}),M?(0,o.jsx)("div",{className:"animate-pulse h-6 w-32 bg-gray-200 rounded"}):(0,o.jsx)("div",{className:"text-lg font-semibold text-blue-700",children:null!==F?(0,o.jsx)(eU,{sui:F}):"Unable to fetch balance"})]}),(0,o.jsxs)("div",{className:"text-right",children:[(0,o.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Wallet Address:"}),(0,o.jsx)("p",{className:"text-sm font-mono bg-white px-2 py-1 rounded border border-gray-200",children:f?"".concat(f.substring(0,6),"...").concat(f.substring(f.length-4)):""})]})]})})]}),(0,o.jsxs)("div",{className:"px-2",children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4 border-l-4 border-blue-500 pl-3",children:"Circle Details"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg shadow-sm",children:[(0,o.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Circle Name"}),(0,o.jsx)("p",{className:"text-lg font-medium",children:v.name})]}),(0,o.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg shadow-sm",children:[(0,o.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Contribution Amount"}),(0,o.jsx)(eU,{usd:v.contributionAmountUsd,sui:v.contributionAmount})]}),(0,o.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg shadow-sm",children:[(0,o.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Security Deposit Required"}),(0,o.jsx)(eU,{usd:v.securityDepositUsd,sui:v.securityDeposit})]}),(0,o.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg shadow-sm",children:[(0,o.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Security Deposit Status"}),M?(0,o.jsx)("div",{className:"animate-pulse h-6 w-32 bg-gray-200 rounded"}):(0,o.jsx)("div",{className:"flex items-center",children:k?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"h-4 w-4 rounded-full bg-green-500 mr-2"}),(0,o.jsx)("span",{className:"text-green-700 font-medium",children:"Paid"})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"h-4 w-4 rounded-full bg-amber-500 mr-2"}),(0,o.jsx)("span",{className:"text-amber-700 font-medium",children:"Not Paid"})]})})]}),v&&v.isActive&&(0,o.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg shadow-sm md:col-span-2 mb-6",children:[(0,o.jsxs)("h3",{className:"text-lg font-medium text-gray-800 mb-4 text-center",children:["Contributions Made Cycle ",ec,"/",v.maxMembers||5]}),(0,o.jsx)("div",{className:"flex justify-center",children:(0,o.jsx)(_,{circleId:v.id,maxMembers:v.maxMembers||5,currentCycle:ec})})]}),(0,o.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg shadow-sm md:col-span-2",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,o.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Custody Wallet Balances"}),(0,o.jsx)("button",{onClick:()=>{ex(),eD(),ep()},disabled:Y||eo,className:"text-xs bg-indigo-50 hover:bg-indigo-100 text-indigo-600 py-1 px-2 rounded flex items-center transition-colors disabled:opacity-50",children:Y||eo?(0,o.jsxs)("span",{className:"flex items-center",children:[(0,o.jsxs)("svg",{className:"animate-spin -ml-1 mr-1 h-3 w-3 text-indigo-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Refreshing..."]}):(0,o.jsxs)("span",{className:"flex items-center",children:[(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh All Balances"]})})]}),(eo||null!==et)&&(0,o.jsxs)("div",{className:"mb-4 border-b border-gray-200 pb-4",children:[(0,o.jsx)("p",{className:"text-xs text-gray-500 mb-1 font-medium",children:"SUI"}),eo?(0,o.jsx)("div",{className:"animate-pulse h-6 w-32 bg-gray-200 rounded mb-2"}):(0,o.jsxs)("div",{className:"flex items-center mb-2",children:[(0,o.jsx)("span",{className:"text-lg font-medium text-blue-700",children:null!==et?"".concat(et.toFixed(6)," SUI"):"-"}),(0,o.jsx)("span",{className:"ml-2 px-2 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full",children:"Total"})]}),null!==et&&et>0&&(0,o.jsxs)("div",{className:"space-y-1 pl-2",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("div",{className:"w-3 h-3 bg-amber-300 rounded-sm mr-2"}),(0,o.jsxs)("span",{className:"text-sm text-gray-700",children:[null!==en?en.toFixed(6):"0.00"," SUI"]}),(0,o.jsx)("span",{className:"ml-2 px-1.5 py-0.5 bg-amber-100 text-amber-800 text-xs font-medium rounded-full",children:"Security Deposits"})]}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("div",{className:"w-3 h-3 bg-green-300 rounded-sm mr-2"}),(0,o.jsxs)("span",{className:"text-sm text-gray-700",children:[null!==er?er.toFixed(6):"0.00"," SUI"]}),(0,o.jsx)("span",{className:"ml-2 px-1.5 py-0.5 bg-green-100 text-green-800 text-xs font-medium rounded-full",children:"Available for Contributions"})]})]})]}),(Y||null!==J)&&(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("p",{className:"text-xs text-gray-500 mb-1 font-medium",children:"USDC"}),Y?(0,o.jsx)("div",{className:"animate-pulse h-6 w-32 bg-gray-200 rounded mb-2"}):(0,o.jsxs)("div",{className:"flex items-center mb-2",children:[(0,o.jsx)("span",{className:"text-lg font-medium text-indigo-700",children:null!==J?"$".concat(J.toFixed(2)," USDC"):"-"}),(0,o.jsx)("span",{className:"ml-2 px-2 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full",children:"Total"})]}),null!==J&&J>0&&(0,o.jsxs)("div",{className:"space-y-1 pl-2",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("div",{className:"w-3 h-3 bg-amber-300 rounded-sm mr-2"}),(0,o.jsxs)("span",{className:"text-sm text-gray-700",children:["$",(null==O?void 0:O.toFixed(2))||"0.00"," USDC"]}),(0,o.jsx)("span",{className:"ml-2 px-1.5 py-0.5 bg-amber-100 text-amber-800 text-xs font-medium rounded-full",children:"Security Deposits"})]}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("div",{className:"w-3 h-3 bg-green-300 rounded-sm mr-2"}),(0,o.jsxs)("span",{className:"text-sm text-gray-700",children:["$",(null==z?void 0:z.toFixed(2))||"0.00"," USDC"]}),(0,o.jsx)("span",{className:"ml-2 px-1.5 py-0.5 bg-green-100 text-green-800 text-xs font-medium rounded-full",children:"Available for Contributions"})]})]})]}),!eo&&null===et&&!Y&&null===J&&(0,o.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"Could not fetch custody wallet balances."})]})]})]}),(0,o.jsxs)("div",{className:"pt-6 border-t border-gray-200 px-2",children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4 border-l-4 border-blue-500 pl-3",children:"Make Contribution"}),(null==v?void 0:v.autoSwapEnabled)&&(0,o.jsx)("div",{className:"mb-4 p-3 bg-blue-50 rounded border border-blue-200",children:(0,o.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,o.jsx)("strong",{children:"Auto-swap enabled:"})," Your SUI contribution will automatically be swapped to USDC."]})}),eu&&(0,o.jsx)("div",{className:"mb-4 p-4 bg-green-50 rounded-lg border-2 border-green-200",children:(0,o.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,o.jsx)("div",{className:"bg-green-100 p-1.5 rounded-full flex-shrink-0 mt-0.5",children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("h4",{className:"font-medium text-green-800",children:"You already contributed for this cycle"}),(0,o.jsxs)("p",{className:"text-sm text-green-700 mt-1",children:["Your contribution for cycle ",ec," has been recorded. You'll be able to contribute again in the next cycle."]})]})]})}),K&&null!==V&&(null==v?void 0:v.autoSwapEnabled)&&(0,o.jsx)("div",{className:"mb-4 p-4 bg-emerald-50 rounded-lg border-2 border-emerald-200",children:(0,o.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,o.jsx)("div",{className:"bg-emerald-100 p-1.5 rounded-full flex-shrink-0 mt-0.5",children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-emerald-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("h4",{className:"font-medium text-emerald-800",children:"Use USDC from your wallet"}),(0,o.jsxs)("p",{className:"text-sm text-emerald-700 mt-1",children:["You have ",(0,o.jsxs)("span",{className:"font-medium",children:["$",V.toFixed(2)," USDC"]})," in your wallet. You can directly deposit ",k?"contribution":"security deposit"," without swapping SUI."]}),(0,o.jsx)("div",{className:"mt-3",children:(0,o.jsx)("button",{onClick:eI,disabled:Z||k&&!(null==v?void 0:v.isActive)||eu,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-medium rounded-md shadow-sm transition-colors disabled:opacity-70 disabled:cursor-not-allowed",children:Z?(0,o.jsxs)("span",{className:"flex items-center",children:[(0,o.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):k?eu?"Already Contributed":"Contribute ".concat(null==v?void 0:null===(t=v.contributionAmountUsd)||void 0===t?void 0:t.toFixed(2)," USDC Directly"):"Deposit ".concat(null==v?void 0:null===(e=v.securityDepositUsd)||void 0===e?void 0:e.toFixed(2)," USDC as Security Deposit")})})]})]})}),(null==v?void 0:v.autoSwapEnabled)?(0,o.jsxs)(o.Fragment,{children:[!v.isActive&&(0,o.jsxs)("div",{className:"mb-4 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[(0,o.jsx)("p",{className:"text-sm text-amber-700 font-medium",children:"This circle is not active yet"}),(0,o.jsx)("p",{className:"text-xs text-amber-600 mt-1",children:k?"Regular contributions are disabled until the admin activates the circle. Please check back later.":"Security deposits can still be paid before activation."})]}),(0,o.jsx)(N,{walletId:(null==v?void 0:v.walletId)||"",circleId:(null==v?void 0:v.id)||"",contributionAmount:eC(),securityDepositPaid:k,securityDepositAmount:eh(),onComplete:()=>{ex(),eb(),ef()},disabled:k&&(!(null==v?void 0:v.isActive)||eu)})]}):(0,o.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg shadow-sm",children:[(0,o.jsxs)("div",{className:"mb-6",children:[(0,o.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"You are about to contribute:"}),(0,o.jsx)("div",{className:"flex items-center",children:(0,o.jsxs)("span",{className:"bg-blue-100 text-blue-800 text-xl font-semibold rounded-lg py-2 px-4",children:["$",(null==v?void 0:null===(s=v.contributionAmountUsd)||void 0===s?void 0:s.toFixed(2))||"0.00"," (",eC().toFixed(4)," SUI)"]})})]}),k&&null!==F&&(0,o.jsx)("script",{dangerouslySetInnerHTML:{__html:'\n                  console.log("Balance check:", {\n                    userBalance: '.concat(F,",\n                    contributionAmount: ").concat(null==v?void 0:v.contributionAmount,",\n                    hasEnough: ").concat(F>=((null==v?void 0:v.contributionAmount)||0),",\n                    difference: ").concat(F-((null==v?void 0:v.contributionAmount)||0),"\n                  });\n                ")}}),(()=>{if(!k||null===F)return null;let e=ej();return F>=e?null:(0,o.jsxs)("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg border border-red-200",children:[(0,o.jsx)("p",{className:"text-sm font-medium",children:"⚠️ Your wallet balance is insufficient for this contribution."}),(0,o.jsxs)("p",{className:"text-xs mt-1",children:["Required base amount: ",eC().toFixed(4)," SUI",(0,o.jsx)("br",{}),"With slippage & fees: ",e.toFixed(4)," SUI",(0,o.jsx)("br",{}),"Available: ",F.toFixed(4)," SUI"]})]})})(),k&&v&&eC()>0&&(0,o.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[(0,o.jsx)("p",{className:"text-sm font-medium text-blue-800",children:"Estimated amount needed for contribution:"}),(0,o.jsxs)("div",{className:"text-blue-700 text-xs space-y-1 mt-2",children:[(0,o.jsxs)("p",{children:["Base contribution: ",eC().toFixed(4)," SUI"]}),(0,o.jsxs)("p",{children:["+ Slippage (",.5,"%): ",(.5*eC()/100).toFixed(4)," SUI"]}),(0,o.jsxs)("p",{children:["+ Rate buffer (",1.5,"%): ",(1.5*eC()/100).toFixed(4)," SUI"]}),(0,o.jsxs)("p",{children:["+ Network fee: ","0.000210"," SUI"]}),(0,o.jsxs)("p",{className:"font-semibold border-t border-blue-200 pt-1 mt-1",children:["Total required: ",ej().toFixed(4)," SUI"]})]})]}),!k&&(0,o.jsx)("div",{className:"mb-4 p-4 bg-amber-50 rounded-lg border-2 border-amber-300",children:(0,o.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-base font-medium text-amber-700 mb-1",children:"⚠️ Security deposit required"}),(0,o.jsxs)("p",{className:"text-sm text-amber-600",children:["You need to pay a security deposit of"," ",!v||isNaN(v.securityDeposit)||v.securityDeposit<=0?"amount unavailable":(0,o.jsx)("span",{className:"font-semibold",children:(0,o.jsx)(eU,{usd:v.securityDepositUsd,className:"inline"})})," ","before contributing."]})]}),null!==F&&v&&v.securityDeposit>0&&(0,o.jsxs)("div",{className:"bg-blue-50 p-2 rounded border border-blue-100 text-sm",children:[(0,o.jsx)("p",{className:"font-medium text-blue-800",children:"Estimated amount needed:"}),(0,o.jsxs)("div",{className:"text-blue-700 text-xs space-y-1 mt-1",children:[(0,o.jsxs)("p",{children:["Base deposit: ",eh().toFixed(4)," SUI"]}),(0,o.jsxs)("p",{children:["+ Slippage (",.5,"%): ",(.5*eh()/100).toFixed(4)," SUI"]}),(0,o.jsxs)("p",{children:["+ Rate buffer (",1.5,"%): ",(1.5*eh()/100).toFixed(4)," SUI"]}),(0,o.jsxs)("p",{children:["+ Network fee: ","0.000210"," SUI"]}),(0,o.jsxs)("p",{className:"font-semibold border-t border-blue-200 pt-1 mt-1",children:["Total required: ",ev().toFixed(4)," SUI"]})]})]}),null!==F&&v&&F<ev()&&(0,o.jsxs)("div",{className:"p-2 bg-red-50 text-red-700 rounded border border-red-200 text-sm",children:[(0,o.jsx)("p",{className:"font-medium",children:"Insufficient funds for security deposit"}),(0,o.jsxs)("p",{className:"text-xs mt-1",children:["You need ",ev().toFixed(4)," SUI for the security deposit (including slippage & fees), but your balance is only ",F.toFixed(4)," SUI."]})]}),(0,o.jsx)("button",{onClick:eN,disabled:R||!v||v.securityDepositUsd<=0||null!==F&&F<ev(),className:"w-full py-3 px-4 rounded-lg shadow-sm text-sm font-bold text-white bg-amber-500 hover:bg-amber-600 transition-all disabled:opacity-70 disabled:cursor-not-allowed",children:R?(0,o.jsxs)("span",{className:"flex items-center justify-center",children:[(0,o.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Pay Security Deposit"}),(0,o.jsx)("p",{className:"text-xs text-gray-600",children:"Note: You must pay the security deposit before you can make contributions. The deposit is refundable if you decide to leave the circle later."})]})}),k&&(0,o.jsx)("div",{className:"mb-4 p-3 rounded-lg border",children:k&&null!==z&&(null==v?void 0:v.contributionAmountUsd)!==void 0&&z>=v.contributionAmountUsd?(0,o.jsxs)("div",{className:"bg-green-50 border-green-200 p-3 rounded-lg flex items-start",children:[(0,o.jsx)("div",{className:"bg-green-100 rounded-full p-1 mr-3 mt-0.5",children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-600",viewBox:"0 0 20 20",fill:"currentColor",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-sm font-medium text-green-800",children:"USDC available for contribution"}),(0,o.jsxs)("p",{className:"text-xs text-green-700 mt-1",children:["Your contribution will use $",z.toFixed(2)," USDC from the contribution funds in the custody wallet. No SUI will be taken from your wallet for this contribution."]})]})]}):(0,o.jsxs)("div",{className:"bg-blue-50 border-blue-200 p-3 rounded-lg flex items-start",children:[(0,o.jsx)("div",{className:"bg-blue-100 rounded-full p-1 mr-3 mt-0.5",children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-blue-600",viewBox:"0 0 20 20",fill:"currentColor",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-sm font-medium text-blue-800",children:"Using SUI for contribution"}),(0,o.jsxs)("p",{className:"text-xs text-blue-700 mt-1",children:["This contribution will require ",eC().toFixed(4)," SUI from your wallet.",null!==z&&z>0&&(0,o.jsxs)("span",{children:[" The custody wallet has $",z.toFixed(2)," USDC available for contributions, but it's not enough for this contribution."]})]})]})]})}),(0,o.jsx)("button",{onClick:eg,disabled:w||null!==F&&F<ej()||!k||!(null==v?void 0:v.isActive)&&k||eu,className:"w-full flex justify-center py-3 px-4 rounded-lg shadow-sm text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 transition-all disabled:opacity-70 disabled:cursor-not-allowed",children:w?"Processing...":eu?"Already Contributed":"Contribute Now"}),(0,o.jsx)("p",{className:"mt-3 text-xs text-center text-gray-500",children:"By contributing, you agree to the circle's terms and conditions."}),v&&!v.isActive&&(0,o.jsxs)("div",{className:"mt-3 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[(0,o.jsx)("p",{className:"text-sm text-amber-700 font-medium",children:"This circle is not active yet"}),(0,o.jsx)("p",{className:"text-xs text-amber-600 mt-1",children:k?"Regular contributions are disabled until the admin activates the circle. Please check back later.":"Security deposits can still be paid before activation."})]})]})]})]}):(0,o.jsx)("div",{className:"py-8 text-center",children:(0,o.jsx)("p",{className:"text-gray-500",children:"Circle not found"})})]})})]})})}):null}},3787:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});let o=(0,s(9279).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},3741:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});let o=(0,s(9279).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},1438:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});let o=(0,s(9279).A)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},8774:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});let o=(0,s(9279).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},4175:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});let o=(0,s(9279).A)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[895,912,454,598,636,593,792],()=>t(2275)),_N_E=e.O()}]);